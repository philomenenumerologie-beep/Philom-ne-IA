<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PhilomÃ¨ne IA â€” Espace Culture</title>
  <style>
    :root{
      --bg-a:#150b12;
      --bg-b:#1b1422;
      --grad-1:#ff7a59;
      --grad-2:#ff3da1;
      --card:#221629;
      --text:#fff;
      --muted:#ffcbd6;
      --accent:#ffd9b5;
      --btn-1:#ff7a59;
      --btn-2:#ff3da1;
      --user:#2a2033;
      --bot:#1e1726;
    }
    *{box-sizing:border-box}
    body{
      margin:0;color:var(--text);
      font-family: "Poppins",system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;
      background:
        radial-gradient(1200px 800px at 0% -10%, rgba(255,122,89,.22), transparent 60%),
        radial-gradient(1200px 800px at 110% -10%, rgba(255,61,161,.18), transparent 60%),
        linear-gradient(160deg, var(--bg-a), var(--bg-b) 70%);
      min-height:100dvh; display:flex; align-items:center; justify-content:center; padding:32px;
    }
    .app{ width:min(920px, 100%); background:rgba(20,12,22,.55); border:1px solid rgba(255,122,89,.18);
      border-radius:20px; box-shadow:0 10px 40px rgba(0,0,0,.45), inset 0 0 0 1px rgba(255,255,255,.04) }
    header{ padding:28px 26px 10px }
    h1{ margin:0; font-size:clamp(26px, 4.5vw, 36px); line-height:1.15; }
    .brand{display:flex; gap:14px; align-items:center}
    .logo{width:46px; height:46px; border-radius:12px; background:
      radial-gradient(70% 70% at 60% 35%, rgba(255,255,255,.9), rgba(255,255,255,.15) 60%),
      linear-gradient(135deg, var(--grad-1), var(--grad-2));
      box-shadow: 0 10px 25px rgba(255,61,161,.22), inset 0 0 30px rgba(255,255,255,.12)}
    .subtitle{color:var(--muted); margin-top:6px}

    .chat{ padding: 0 16px 16px; display:flex; flex-direction:column; gap:12px; max-height:60dvh; overflow:auto }
    .bubble{ border-radius:16px; padding:14px 16px; line-height:1.55; }
    .bot{ align-self:flex-start; background:var(--bot); border:1px solid rgba(255,122,89,.18)}
    .you{ align-self:flex-end; background:var(--user); border:1px solid rgba(255,122,89,.14)}
    .system{ color:#ffd7e7 }

    .composer{ display:flex; gap:10px; padding:16px; border-top:1px solid rgba(255,122,89,.18); background:rgba(0,0,0,.25); border-radius:0 0 20px 20px }
    textarea{
      flex:1; resize:none; min-height:52px; max-height:160px; padding:14px 14px 14px 16px;
      color:var(--text); background:rgba(255,255,255,.03); border:1px solid rgba(255,122,89,.2);
      border-radius:12px; outline:none; box-shadow: inset 0 1px 0 rgba(255,255,255,.05);
    }
    button{
      background:linear-gradient(135deg, var(--btn-1), var(--btn-2));
      color:#fff; border:0; padding:0 22px; border-radius:12px; font-weight:600; cursor:pointer;
      display:flex; align-items:center; gap:10px; min-height:52px; box-shadow:0 10px 22px rgba(255,61,161,.25)
    }
    button:disabled{ opacity:.6; cursor:not-allowed }
    .tips{ color:#ffd9b5; font-size:.85rem; padding:0 22px 18px }
    .fade{ animation:fade .35s ease }
    @keyframes fade{ from{opacity:.35; transform:translateY(4px)} to{opacity:1; transform:none} }
  </style>
</head>
<body>
  <main class="app">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>Espace Culture</h1>
          <div class="subtitle">LittÃ©rature â€¢ CinÃ©ma â€¢ Musique â€¢ Arts & Histoire</div>
        </div>
      </div>
    </header>

    <section id="chat" class="chat">
      <div class="bubble bot fade">
        <strong>Bienvenue ðŸ‘‹</strong><br />
        Je suis <strong class="system">PhilomÃ¨ne Culture</strong>. Je tâ€™aide Ã  dÃ©couvrir, comprendre et apprÃ©cier
        Å“uvres et mouvements (livres, films, musique, arts, histoire, idÃ©es). Je peux rÃ©sumer, expliquer,
        comparer, recommanderâ€¦ tout en donnant du contexte. ðŸŽ¬ðŸ“šðŸŽ¶
      </div>
    </section>

    <form id="composer" class="composer">
      <textarea id="input" placeholder="Une Å“uvre ? Un courant ? Une recommandation ?"></textarea>
      <button id="send" type="submit">Envoyer ðŸŽ¨</button>
    </form>
    <div class="tips">Exemples : Â« RÃ©sume-moiâ€¦ Â», Â« Donne-moi 5 films commeâ€¦ Â», Â« Explique le contexte deâ€¦ Â»</div>
  </main>

  <script>
    const ENDPOINT_PATH = "/chat";

    const SYSTEM_PROMPT = `
Tu es PhilomÃ¨ne Culture : pÃ©dagogue, curieuse, accessible.
- Tu donnes le contexte historique/culturel, les thÃ¨mes, lâ€™influence, et des pistes pour aller plus loin.
- Tu proposes des recommandations organisÃ©es (par Ã©poque, style, humeur).
- Tu cites des sources ou rÃ©fÃ©rences lorsque câ€™est pertinent (sans liens si tu nâ€™en as pas).
- Tu conclues par 3 pistes concrÃ¨tes : "Ã€ lire", "Ã€ voir/Ã©couter", "Ã€ explorer".
RÃ©ponds en franÃ§ais.`;

    const chat = document.getElementById('chat');
    const form = document.getElementById('composer');
    const input = document.getElementById('input');
    const sendBtn = document.getElementById('send');

    function addBubble(text, who="bot"){
      const div = document.createElement('div');
      div.className = `bubble ${who} fade`;
      div.innerHTML = text;
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
    }

    async function ask(text){
      sendBtn.disabled = true;
      addBubble(text, "you");
      try{
        const r = await fetch(ENDPOINT_PATH, {
          method:"POST",
          headers:{"Content-Type":"application/json"},
          body: JSON.stringify({ system: SYSTEM_PROMPT, message: text, agent:"culture"})
        });
        const data = await r.json();
        addBubble(data.reply || "DÃ©solÃ©, je nâ€™ai pas pu rÃ©pondre cette fois.");
      }catch(e){
        addBubble("Oups, une erreur sâ€™est produite. RÃ©essaie.");
      }finally{
        sendBtn.disabled = false;
      }
    }

    form.addEventListener('submit', e=>{
      e.preventDefault();
      const text = input.value.trim();
      if(!text) return;
      input.value = "";
      ask(text);
    });
  </script>
</body>
</html>
