<!DOCTYPE html>
<html lang="fr" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
  <title>Philom√®ne I.A.</title>
  <meta name="description" content="Philom√®ne I.A., assistante personnelle intelligente. Si tu as un probl√®me, elle a la solution. Ensemble on ira plus loin." />

  <!-- Couleur barre du haut sur mobile -->
  <meta name="theme-color" content="#000000" />

  <!-- Manifest (PWA) -->
  <link rel="manifest" href="manifest.webmanifest" />

  <!-- Ic√¥ne raccourci navigateur -->
  <link rel="icon" href="icon-192.png" />

  <style>
    :root {
      --bg-page-light:#f5f5f5;
      --bg-card-light:#2a2a2a;
      --text-light:#111;
      --text-invert-light:#fff;
      --accent:#ffd84a;

      --bg-page-dark:#121212;
      --bg-card-dark:#2a2a2a;
      --text-dark:#fff;
      --input-bg-dark:#1a1a1a;
      --border-dark:#3a3a3a;
      --panel-bg-dark:#1a1a1a;
      --panel-border-dark:#444;
      --bubble-user-bg:#5a4bff;
      --bubble-user-text:#fff;
    }

    body {
      margin:0;
      padding:0;
      font-family:-apple-system, BlinkMacSystemFont, "Inter", "Roboto", "Helvetica Neue", Arial, sans-serif;
      -webkit-font-smoothing:antialiased;
      background-color:var(--bg-page-dark);
      color:var(--text-dark);
      display:flex;
      flex-direction:column;
      min-height:100dvh;
      position:relative;
    }

    body.light {
      background-color:var(--bg-page-light);
      color:var(--text-light);
    }

    /* HEADER */
    .topbar {
      position:fixed;
      top:0;
      left:0;
      right:0;
      z-index:100;
      background-color:#000;
      color:#fff;
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:12px 16px;
      box-shadow:0 20px 40px rgba(0,0,0,0.6);
      background-image:linear-gradient(to bottom,rgba(0,0,0,0.9),rgba(0,0,0,0.6));
    }

    body.light .topbar {
      background:#fff;
      color:#000;
      box-shadow:0 20px 40px rgba(0,0,0,0.15);
      background-image:linear-gradient(to bottom,rgba(255,255,255,1),rgba(255,255,255,0.6));
    }

    .top-left,
    .top-right {
      display:flex;
      align-items:center;
      gap:16px;
      min-width:70px;
    }

    .burger-btn,
    .kebab-btn {
      background:none;
      border:0;
      color:inherit;
      font-size:24px;
      line-height:1;
      padding:8px;
      border-radius:8px;
    }

    .burger-btn:active,
    .kebab-btn:active{
      background:rgba(255,255,255,0.1);
    }
    body.light .burger-btn:active,
    body.light .kebab-btn:active{
      background:rgba(0,0,0,0.07);
    }

    .tokens-box {
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      font-size:15px;
      line-height:1.2;
      color:#ffd84a;
      font-weight:600;
    }

    body.light .tokens-box {
      color:#c7a600;
    }

    .tokens-box .line1 {
      display:flex;
      align-items:center;
      gap:8px;
    }

    .diamond {
      font-size:20px;
      line-height:1;
    }

    /* CONTENU CHAT */
    .main {
      flex:1;
      display:flex;
      flex-direction:column;
      padding:100px 16px 160px; /* espace topbar + bottom bar */
      box-sizing:border-box;
      max-width:700px;
      width:100%;
      margin:0 auto;
    }

    .bubble {
      display:inline-block;
      max-width:90%;
      border-radius:12px;
      padding:16px;
      font-size:18px;
      line-height:1.4;
      box-shadow:0 18px 40px rgba(0,0,0,0.6);
      margin-bottom:16px;
      background:var(--bg-card-dark);
      color:#fff;
    }
    body.light .bubble {
      background:var(--bg-card-light);
      color:#fff;
      box-shadow:0 18px 40px rgba(0,0,0,0.3);
    }

    .bubble.welcome{
      background:var(--bg-card-dark);
      border:1px solid rgba(255,255,255,0.12);
      box-shadow:0 30px 60px rgba(0,0,0,0.8);
      font-size:20px;
      line-height:1.4;
      font-weight:500;
      color:#fff;
    }
    body.light .bubble.welcome{
      background:#2a2a2a;
      border:1px solid rgba(255,255,255,0.2);
      color:#fff;
      box-shadow:0 30px 60px rgba(0,0,0,0.2);
    }

    .bubble.welcome .highlight{
      color:var(--accent);
      font-weight:600;
    }

    .bubble.system{
      background:#2a2a2a;
      border:1px solid rgba(255,255,255,0.2);
      font-size:16px;
      color:#fff;
      box-shadow:0 20px 40px rgba(0,0,0,0.8);
    }
    body.light .bubble.system{
      background:#2a2a2a;
      border:1px solid rgba(255,255,255,0.3);
      color:#fff;
      box-shadow:0 20px 40px rgba(0,0,0,0.4);
    }

    .bubble.user{
      background:var(--bubble-user-bg);
      color:var(--bubble-user-text);
      border-radius:12px;
      align-self:flex-end;
      max-width:70%;
      box-shadow:0 20px 40px rgba(90,75,255,0.5);
    }

    /* ALIGNEMENT BULLES */
    .row{
      display:flex;
      width:100%;
      margin-bottom:12px;
    }
    .row.me{
      justify-content:flex-end;
    }
    .row.philo{
      justify-content:flex-start;
    }

    /* BOTTOM INPUT BAR */
    .input-area-wrap {
      position:fixed;
      left:0;
      right:0;
      bottom:0;
      background:rgba(0,0,0,0.75);
      backdrop-filter:blur(20px);
      -webkit-backdrop-filter:blur(20px);
      border-top:1px solid rgba(255,255,255,0.1);
      box-shadow:0 -30px 60px rgba(0,0,0,0.9);
      padding:16px;
      z-index:80;
      color:#fff;
    }
    body.light .input-area-wrap{
      background:rgba(255,255,255,0.8);
      backdrop-filter:blur(20px);
      -webkit-backdrop-filter:blur(20px);
      border-top:1px solid rgba(0,0,0,0.1);
      color:#000;
      box-shadow:0 -30px 60px rgba(0,0,0,0.15);
    }

    .input-top-row{
      display:flex;
      align-items:flex-start;
      gap:12px;
      margin-bottom:8px;
      position:relative;
    }

    .plus-btn{
      background:#4a31ff;
      color:#fff;
      font-size:24px;
      font-weight:500;
      width:44px;
      height:44px;
      min-width:44px;
      border-radius:10px;
      border:none;
      display:flex;
      align-items:center;
      justify-content:center;
      box-shadow:0 20px 40px rgba(74,49,255,0.6);
    }

    .plus-btn:active{
      opacity:0.8;
    }

    .plus-menu{
      position:absolute;
      left:0;
      bottom:60px;
      background:var(--panel-bg-dark);
      border:1px solid var(--panel-border-dark);
      border-radius:10px;
      box-shadow:0 30px 60px rgba(0,0,0,0.9);
      display:none;
      flex-direction:column;
      min-width:260px;
      color:#fff;
      overflow:hidden;
      font-size:16px;
    }
    .plus-menu.show{
      display:flex;
    }
    body.light .plus-menu{
      background:#1a1a1a;
      border:1px solid #444;
      color:#fff;
      box-shadow:0 30px 60px rgba(0,0,0,0.4);
    }

    .plus-item{
      display:flex;
      align-items:flex-start;
      gap:12px;
      padding:14px 16px;
      border-bottom:1px solid rgba(255,255,255,0.08);
      color:#fff;
    }
    .plus-item:last-child{
      border-bottom:none;
    }
    .plus-item:active{
      background:rgba(255,255,255,0.08);
    }
    .plus-emoji{
      font-size:20px;
      line-height:1.2;
      width:24px;
    }
    .plus-text{
      font-size:16px;
      line-height:1.3;
      font-weight:500;
      color:#fff;
    }

    .input-field-wrap{
      flex:1;
      background:var(--input-bg-dark);
      border:2px solid var(--bubble-user-bg);
      border-radius:10px;
      display:flex;
      align-items:center;
      padding:10px 12px;
      font-size:17px;
      box-shadow:0 20px 40px rgba(0,0,0,0.9);
    }
    body.light .input-field-wrap{
      background:#fff;
      color:#000;
      border:2px solid #4a31ff;
      box-shadow:0 20px 40px rgba(0,0,0,0.12);
    }

    .input-field{
      border:none;
      background:transparent;
      color:#fff;
      flex:1;
      font-size:17px;
      line-height:1.4;
      outline:none;
    }
    body.light .input-field{
      color:#000;
    }

    .send-btn{
      background:#4a31ff;
      border:none;
      color:#fff;
      width:44px;
      height:44px;
      min-width:44px;
      border-radius:10px;
      font-size:20px;
      font-weight:600;
      display:flex;
      align-items:center;
      justify-content:center;
      box-shadow:0 20px 40px rgba(74,49,255,0.6);
    }
    .send-btn:active{
      opacity:0.8;
    }

    .token-line{
      font-size:15px;
      text-align:center;
      color:#aaa;
    }
    body.light .token-line{
      color:#444;
    }

    /* MENU 3 POINTS (header droite) */
    .menu-panel{
      position:fixed;
      right:16px;
      top:70px;
      background:var(--panel-bg-dark);
      border:1px solid var(--panel-border-dark);
      color:#fff;
      border-radius:10px;
      box-shadow:0 30px 60px rgba(0,0,0,0.9);
      min-width:250px;
      font-size:16px;
      line-height:1.3;
      display:none;
      overflow:hidden;
      z-index:200;
    }
    .menu-panel.show{
      display:block;
    }
    body.light .menu-panel{
      background:#1a1a1a;
      border:1px solid #444;
      color:#fff;
      box-shadow:0 30px 60px rgba(0,0,0,0.4);
    }
    .menu-item{
      display:flex;
      align-items:flex-start;
      gap:12px;
      padding:14px 16px;
      border-bottom:1px solid rgba(255,255,255,0.08);
      color:#fff;
    }
    .menu-item:last-child{
      border-bottom:none;
    }
    .menu-item:active{
      background:rgba(255,255,255,0.08);
    }
    .menu-emoji{
      width:24px;
      font-size:20px;
      line-height:1.2;
    }
    .menu-text{
      font-size:16px;
      font-weight:500;
    }

    /* A PROPOS PANEL */
    .about-panel{
      position:fixed;
      left:16px;
      right:16px;
      top:120px;
      background:#2a2a2a;
      color:#fff;
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.2);
      box-shadow:0 30px 60px rgba(0,0,0,0.9);
      padding:16px;
      font-size:17px;
      line-height:1.4;
      display:none;
      z-index:250;
    }
    .about-panel.show{
      display:block;
    }
    .about-close{
      color:#4a7dff;
      font-weight:500;
      font-size:16px;
      text-align:right;
      margin-top:12px;
    }
    .about-close:active{
      opacity:0.6;
    }
    body.light .about-panel{
      background:#2a2a2a;
      border:1px solid rgba(255,255,255,0.3);
      color:#fff;
      box-shadow:0 30px 60px rgba(0,0,0,0.4);
    }
    .about-title{
      font-weight:600;
      margin-bottom:8px;
      font-size:18px;
    }

    /* HIDE SCROLLBARS ON MOBILE BODY */
    body{
      overscroll-behavior-y:none;
    }
  </style>
</head>
<body class="dark">
  <!-- HEADER -->
  <header class="topbar">
    <div class="top-left">
      <button class="burger-btn" id="openAccountBtn">‚ò∞</button>
    </div>

    <div class="tokens-box">
      <div class="line1">
        <span class="diamond">üíé</span>
        <span id="tokenCount">5000 tokens</span>
      </div>
    </div>

    <div class="top-right">
      <button class="kebab-btn" id="menuBtn">‚ãØ</button>
    </div>
  </header>

  <!-- MAIN CHAT AREA -->
  <main class="main" id="chatArea">
    <div class="row philo">
      <div class="bubble welcome">
        <span class="highlight">üëã Bonjour ! Je suis Philom√®ne I.A.,</span> votre assistante personnelle.<br/>
        Si vous avez un probl√®me, j‚Äôai la solution.<br/>
        Vous avez une question, j‚Äôai la r√©ponse.<br/>
        Ensemble, on ira plus loin üê¶
      </div>
    </div>

    <div class="row me">
      <div class="bubble user">Bj</div>
    </div>

    <div class="row philo">
      <div class="bubble system" id="thinkingBubble">
        Philom√®ne r√©fl√©chit √† votre message...
      </div>
    </div>
  </main>

  <!-- BOTTOM INPUT -->
  <section class="input-area-wrap">
    <div class="input-top-row">
      <button class="plus-btn" id="plusBtn">Ôºã</button>

      <div class="input-field-wrap">
        <input id="userInput" class="input-field" placeholder="√âcrivez votre message..." autocomplete="off" />
      </div>

      <button class="send-btn" id="sendBtn">‚û§</button>

      <!-- menu + -->
      <div class="plus-menu" id="plusMenu">
        <div class="plus-item">
          <div class="plus-emoji">üì∏</div>
          <div class="plus-text">Envoyer une photo</div>
        </div>
        <div class="plus-item">
          <div class="plus-emoji">üìÑ</div>
          <div class="plus-text">Envoyer un document</div>
        </div>
        <div class="plus-item">
          <div class="plus-emoji">üéôÔ∏è</div>
          <div class="plus-text">Utiliser le micro</div>
        </div>
      </div>
    </div>

    <div class="token-line">
      Pr√™t ‚Ä¢ <span id="tokenLineCount">5000 tokens restants</span>
    </div>
  </section>

  <!-- MENU 3 POINTS -->
  <div class="menu-panel" id="menuPanel">
    <div class="menu-item" id="toggleTheme">
      <div class="menu-emoji">üåô</div>
      <div class="menu-text">Mode jour/nuit</div>
    </div>
    <div class="menu-item" id="toggleSound">
      <div class="menu-emoji">üì°</div>
      <div class="menu-text">Son ON/OFF</div>
    </div>
    <div class="menu-item" id="openAbout">
      <div class="menu-emoji">‚ùì</div>
      <div class="menu-text">√Ä propos</div>
    </div>
  </div>

  <!-- A PROPOS -->
  <div class="about-panel" id="aboutPanel">
    <div class="about-title">üí° Philom√®ne I.A., c‚Äôest quoi ?</div>
    <div>
      Philom√®ne I.A. est ton assistante personnelle intelligente.
      Elle t‚Äôaide, te conseille et t‚Äôaccompagne au quotidien.
      Ensemble, on ira plus loin.
    </div>
    <div class="about-close" id="aboutClose">Fermer</div>
  </div>

  <script>
    /* Helpers */
    const bodyEl = document.body;
    const plusBtn = document.getElementById("plusBtn");
    const plusMenu = document.getElementById("plusMenu");
    const menuBtn = document.getElementById("menuBtn");
    const menuPanel = document.getElementById("menuPanel");
    const openAboutBtn = document.getElementById("openAbout");
    const aboutPanel = document.getElementById("aboutPanel");
    const aboutClose = document.getElementById("aboutClose");
    const toggleThemeBtn = document.getElementById("toggleTheme");
    const tokenCountEl = document.getElementById("tokenCount");
    const tokenLineEl = document.getElementById("tokenLineCount");
    const sendBtn = document.getElementById("sendBtn");
    const userInput = document.getElementById("userInput");
    const chatArea = document.getElementById("chatArea");
    const thinkingBubble = document.getElementById("thinkingBubble");

    let soundOn = true;
    let tokens = 5000;

    function closeAllPopups() {
      plusMenu.classList.remove("show");
      menuPanel.classList.remove("show");
      aboutPanel.classList.remove("show");
    }

    // bouton +
    plusBtn.addEventListener("click", (e)=>{
      e.stopPropagation();
      const isOpen = plusMenu.classList.contains("show");
      closeAllPopups();
      if (!isOpen) {
        plusMenu.classList.add("show");
      }
    });

    // menu 3 points
    menuBtn.addEventListener("click",(e)=>{
      e.stopPropagation();
      const isOpen = menuPanel.classList.contains("show");
      closeAllPopups();
      if(!isOpen){
        menuPanel.classList.add("show");
      }
    });

    // a propos
    openAboutBtn.addEventListener("click",(e)=>{
      e.stopPropagation();
      menuPanel.classList.remove("show");
      aboutPanel.classList.add("show");
    });
    aboutClose.addEventListener("click",()=>{
      aboutPanel.classList.remove("show");
    });

    // toggle theme
    toggleThemeBtn.addEventListener("click",()=>{
      bodyEl.classList.toggle("light");
    });

    // toggle son
    document.getElementById("toggleSound").addEventListener("click",()=>{
      soundOn = !soundOn;
      // si tu veux plus tard: jouer un bip ou couper lecture
    });

    // Envoi message
    function addUserMessage(txt){
      const row = document.createElement("div");
      row.className = "row me";

      const bubble = document.createElement("div");
      bubble.className = "bubble user";
      bubble.textContent = txt;

      row.appendChild(bubble);
      chatArea.appendChild(row);
      chatArea.scrollTop = chatArea.scrollHeight;
    }

    function addPhiloThinking(){
      const row = document.createElement("div");
      row.className = "row philo";

      const bubble = document.createElement("div");
      bubble.className = "bubble system";
      bubble.textContent = "Philom√®ne r√©fl√©chit √† votre message...";

      row.appendChild(bubble);
      chatArea.appendChild(row);

      chatArea.scrollTop = chatArea.scrollHeight;
      return bubble;
    }

    async function sendMessage(){
      const text = userInput.value.trim();
      if(!text) return;

      // affiche message utilisateur
      addUserMessage(text);

      // vide champ
      userInput.value = "";

      // tokens --
      tokens = Math.max(tokens-20,0);
      tokenCountEl.textContent = tokens+" tokens";
      tokenLineEl.textContent = tokens+" tokens restants";

      // thinking bubble
      const thinking = addPhiloThinking();

      // ici on branchera l'API plus tard.
      // simulation pour l‚Äôinstant
      setTimeout(()=>{
        thinking.textContent = "Merci pour votre message : \""+text+"\"";
      },1000);
    }

    sendBtn.addEventListener("click", sendMessage);
    userInput.addEventListener("keydown",(e)=>{
      if(e.key==="Enter"){
        e.preventDefault();
        sendMessage();
      }
    });

    // fermer les popups si on clique dehors
    document.addEventListener("click", ()=>{
      closeAllPopups();
    });

    // emp√™cher la fermeture quand on clique dans un popup
    plusMenu.addEventListener("click", e=>e.stopPropagation());
    menuPanel.addEventListener("click", e=>e.stopPropagation());
    aboutPanel.addEventListener("click", e=>e.stopPropagation());

    /* Service Worker registration PWA */
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("./sw.js").catch(()=>{});
    }
  </script>
</body>
</html>
