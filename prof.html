<!DOCTYPE html>
<html lang="fr" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Prof privÃ© â€“ PhilomÃ¨ne</title>
  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            philobg: '#0d0d16',
            philocard: '#111827',
            philopurple: '#a855f7',
            philopink: '#ec4899',
          },
        },
      },
    };
  </script>
</head>

<body class="bg-philobg text-slate-100 min-h-screen">
  <div class="max-w-xl mx-auto px-4 pb-10 pt-6">
    <!-- Retour -->
    <a href="/" class="inline-flex items-center text-sm text-slate-300 hover:text-white mb-6">
      <span class="mr-2">â†</span> Retour Ã  PhilomÃ¨ne
    </a>

    <!-- Titre / intro -->
    <header class="mb-6">
      <h1 class="text-2xl font-bold mb-2">
        ğŸ‘©â€ğŸ« Prof privÃ© â€“ Aide aux devoirs
      </h1>
      <p class="text-slate-300 text-sm leading-relaxed">
        Envoie lâ€™Ã©noncÃ© de ton exercice (en texte ou en photo) et PhilomÃ¨ne
        tâ€™explique <span class="font-semibold">Ã©tape par Ã©tape</span>, sans
        juste donner la rÃ©ponse. Ã‡a marche pour la Belgique ğŸ‡§ğŸ‡ª comme pour la France ğŸ‡«ğŸ‡·.
      </p>
    </header>

    <!-- Carte formulaire -->
    <main class="bg-philocard/80 rounded-2xl shadow-lg border border-slate-800/70 p-4 sm:p-6 space-y-6">
      <form id="prof-form" class="space-y-5">
        <!-- Zone texte -->
        <div>
          <label for="question" class="block text-sm font-medium mb-1">
            âœï¸ Lâ€™Ã©noncÃ© de ton exercice
          </label>
          <textarea
            id="question"
            name="question"
            rows="5"
            class="w-full rounded-xl bg-black/40 border border-slate-700 focus:border-philopurple focus:ring-philopurple text-sm px-3 py-2 outline-none resize-y"
            placeholder="Ex : RÃ©sous ce problÃ¨me, explique-moi bien les Ã©tapes..."
          ></textarea>
          <p class="mt-1 text-xs text-slate-400">
            Tu peux simplement dÃ©crire lâ€™exercice, ou copier-coller lâ€™Ã©noncÃ©.
          </p>
        </div>

        <!-- Upload image -->
        <div>
          <label class="block text-sm font-medium mb-1">
            ğŸ“¸ Ou ajoute une photo de lâ€™exercice (facultatif)
          </label>
          <input
            id="image"
            name="image"
            type="file"
            accept="image/*"
            capture="environment"
            class="w-full text-sm text-slate-200 file:mr-3 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-medium file:bg-slate-700 file:text-slate-100 hover:file:bg-slate-600"
          />
          <p class="mt-1 text-xs text-slate-400">
            Photo claire de la feuille ou du tableau. PhilomÃ¨ne lit le texte et les Ã©quations.
          </p>
        </div>

        <!-- Message info -->
        <div class="rounded-xl bg-black/30 border border-slate-700 px-3 py-2">
          <p class="text-xs text-slate-300">
            Tu peux envoyer <span class="font-semibold">juste du texte, juste une photo, ou les deux</span>.
            PhilomÃ¨ne sâ€™adapte au niveau (primaire, collÃ¨ge, secondaire...).
          </p>
        </div>

        <!-- Bouton -->
        <div>
          <button
            id="submit-btn"
            type="submit"
            class="w-full inline-flex items-center justify-center rounded-2xl bg-gradient-to-r from-philopurple to-philopink px-4 py-3 text-sm font-semibold shadow-md hover:opacity-95 active:scale-[0.99] transition disabled:opacity-60 disabled:cursor-not-allowed"
          >
            <span id="submit-label">ğŸ“ Demander lâ€™aide du prof</span>
          </button>
        </div>

        <!-- Statut -->
        <p id="status" class="text-xs text-slate-300 min-h-[1.25rem]"></p>
      </form>

      <!-- RÃ©sultat -->
      <section
        id="result-card"
        class="hidden mt-2 rounded-2xl border border-philopurple/60 bg-black/40 px-4 py-3 sm:px-5 sm:py-4"
      >
        <h2 class="text-sm font-semibold mb-2 flex items-center">
          ğŸ“˜ Explication de lâ€™exercice
        </h2>
        <div
          id="result-content"
          class="text-sm whitespace-pre-wrap leading-relaxed text-slate-100"
        ></div>
      </section>
    </main>
  </div>

  <!-- Script -->
  <script>
    const form = document.getElementById('prof-form');
    const questionInput = document.getElementById('question');
    const imageInput = document.getElementById('image');
    const statusEl = document.getElementById('status');
    const resultCard = document.getElementById('result-card');
    const resultContent = document.getElementById('result-content');
    const submitBtn = document.getElementById('submit-btn');
    const submitLabel = document.getElementById('submit-label');

    form.addEventListener('submit', async (event) => {
      event.preventDefault();

      const question = questionInput.value.trim();
      const file = imageInput.files[0];

      // VÃ©rif minimum : au moins un des deux
      if (!question && !file) {
        statusEl.textContent =
          'â— Ajoute au moins un Ã©noncÃ© ou une photo pour que le prof puisse tâ€™aider.';
        return;
      }

      // Reset affichage
      statusEl.textContent = 'â³ PhilomÃ¨ne rÃ©flÃ©chit sur ton exercice...';
      resultCard.classList.add('hidden');
      resultContent.textContent = '';
      submitBtn.disabled = true;
      submitLabel.textContent = 'â³ Analyse en cours...';

      try {
        const formData = new FormData();
        if (question) formData.append('question', question);
        if (file) formData.append('image', file);

        const response = await fetch('/api/prof', {
          method: 'POST',
          body: formData,
        });

        if (!response.ok) {
          throw new Error('RÃ©ponse serveur non valide');
        }

        const data = await response.json();

        // On sâ€™attend Ã  data.answer (texte dÃ©jÃ  prÃªt Ã  afficher)
        const answer =
          data.answer ||
          "Je n'ai pas reÃ§u de rÃ©ponse dÃ©taillÃ©e du prof. RÃ©essaie dans un instant.";

        resultContent.textContent = answer;
        resultCard.classList.remove('hidden');
        statusEl.textContent =
          'âœ… VoilÃ  lâ€™explication. Tu peux poser une autre question si quelque chose nâ€™est pas clair.';
      } catch (error) {
        console.error(error);
        statusEl.textContent =
          'âŒ Erreur pendant la gÃ©nÃ©ration. VÃ©rifie ta connexion et rÃ©essaie.';
      } finally {
        submitBtn.disabled = false;
        submitLabel.textContent = 'ğŸ“ Demander lâ€™aide du prof';
      }
    });
  </script>
</body>
</html>
