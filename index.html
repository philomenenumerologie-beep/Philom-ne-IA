<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Philom√®ne I.A.</title>

  <style>
  :root{
    --bg:#0c0c10; --panel:#13131b; --panel-2:#191922;
    --text:#e8e4ff; --muted:#9b96b8; --stroke:#2a2a38; --accent:#6b45ff;
  }
  *{ box-sizing:border-box; }
  html,body{ height:100%; }
  body{
    margin:0; background:var(--bg); color:var(--text);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
  }

  /* Topbar */
  .topbar{
    position:sticky; top:0; z-index:50;
    display:flex; align-items:center; justify-content:space-between;
    padding:10px 14px; background:var(--bg); border-bottom:1px solid var(--stroke);
  }
  .brand{ display:flex; align-items:center; gap:10px; }
  .title{ font-weight:800; font-size:1.25rem; }
  .pill{
    display:inline-flex; align-items:center; gap:8px;
    padding:8px 12px; border-radius:12px;
    background:var(--panel-2); color:var(--text); border:1px solid var(--stroke);
  }
  .pill.login{ font-weight:600; }
  .counter{ font-variant-numeric: tabular-nums; }
  .top-actions{ display:flex; align-items:center; gap:10px; }

  /* Burger panel */
  .menu{
    position:absolute; top:56px; right:14px; z-index:60;
    background:var(--panel); border:1px solid var(--stroke); border-radius:12px;
    box-shadow:0 12px 28px rgba(0,0,0,.45); padding:8px; width:240px;
  }
  .menu.hidden{ display:none; }
  .menu-item{
    width:100%; text-align:left; background:transparent; color:var(--text);
    border:0; border-radius:10px; padding:10px 12px; cursor:pointer;
  }
  .menu-item:hover{ background:var(--panel-2); }

  /* Chat */
  .chat{ padding:16px 14px 120px; max-width:820px; margin:0 auto; }
  .msg{
    background:var(--panel); border:1px solid var(--stroke);
    padding:12px 14px; border-radius:14px; margin:8px 0; line-height:1.45;
  }
  .msg.bot{ color:var(--text); }

  /* Composer */
  .composer{ position:sticky; bottom:0; background:linear-gradient(180deg, rgba(12,12,16,0), var(--bg) 20%); }
  .composer-inner{
    position:relative;
    display:flex; align-items:center; gap:10px;
    max-width:820px; margin:0 auto; padding:12px 14px 8px;
  }
  .plus{
    width:44px; height:44px; border-radius:12px; border:1px solid var(--stroke);
    background:var(--panel-2); color:var(--text); font-size:22px; line-height:1;
  }
  .attach-stack{
    position:absolute; bottom:58px; left:14px;
    display:flex; flex-direction:column; gap:8px;
    background:var(--panel); border:1px solid var(--stroke); border-radius:12px;
    padding:8px; box-shadow:0 12px 28px rgba(0,0,0,.45);
  }
  .attach-stack.hidden{ display:none; }
  .attach-item{
    white-space:nowrap; padding:8px 10px; border-radius:10px; border:1px solid var(--stroke);
    background:var(--panel-2); color:var(--text);
  }
  .input{
    flex:1; height:44px; border-radius:12px; border:1px solid var(--stroke);
    background:#111119; color:var(--text); padding:0 12px;
  }
  .send{
    width:56px; height:44px; border-radius:12px; border:1px solid var(--stroke);
    background:#3b2cff; color:#fff; font-weight:700;
  }
  .powered{
    text-align:center; color:var(--muted); font-size:.9rem; padding:0 0 10px;
  }

  /* Modal FAQ */
  .modal{ position:fixed; inset:0; display:grid; place-items:center; background:rgba(0,0,0,.55); z-index:70; }
  .modal.hidden{ display:none; }
  .modal-card{
    width:min(92%,720px); background:var(--panel); border:1px solid var(--stroke);
    border-radius:16px; padding:12px 14px;
  }
  .modal-head{ display:flex; align-items:center; justify-content:space-between; }
  .modal-body{ color:var(--text); line-height:1.5; }
  .close{
    background:var(--panel-2); color:var(--text); border:1px solid var(--stroke);
    border-radius:10px; padding:6px 10px; cursor:pointer;
  }

  /* Mobile tweaks */
  @media (max-width: 420px){
    .title{ font-size:1.05rem; }
    .pill{ padding:7px 10px; }
    .counter{ padding:7px 10px; }
    .chat{ padding-bottom:130px; }
  }
  .hidden{ display:none; }
  </style>
</head>

<body>
  <!-- TOP BAR -->
  <header class="topbar">
    <div class="brand">
      <span class="heart">ü§ç</span>
      <span class="title">Philom√®ne I.A.</span>
    </div>

    <div class="top-actions">
      <button id="themeBtn" class="pill" aria-label="Mode Jour/Nuit">üåô</button>
      <div class="counter pill">üíé <span id="tokenCounter">1 000 000</span></div>
      <a href="https://accounts.philomeneia.com/" class="pill login">Connexion / Inscription</a>
      <button id="menuBtn" class="pill">‚ò∞</button>
    </div>
  </header>

  <!-- MENU BURGER -->
  <nav id="menuPanel" class="menu hidden">
    <button class="menu-item" id="openFaq">‚ùì FAQ</button>
    <button class="menu-item" id="newChat">üîÑ Nouvelle discussion</button>
  </nav>

  <!-- CHAT -->
  <main id="chat" class="chat">
    <div class="msg bot">
      Bonjour üëã Je suis Philom√®ne I.A., propuls√©e par <b>GPT-5 Thinking</b>.
    </div>
  </main>

  <!-- COMPOSER -->
  <footer class="composer">
    <div class="composer-inner">
      <button id="plusBtn" class="plus">+</button>

      <div id="attachStack" class="attach-stack hidden">
        <button id="attachMic" class="attach-item">üé§ Micro</button>
        <button id="attachCam" class="attach-item">üì∑ Appareil photo</button>
        <button id="attachDoc" class="attach-item">üìÑ Document</button>
      </div>

      <input id="userInput" class="input" placeholder="√âcrivez votre message‚Ä¶" />
      <button id="sendBtn" class="send">‚û§</button>
    </div>

    <div class="powered">‚öôÔ∏è Propuls√© par <b>GPT-5 Thinking</b></div>
  </footer>

  <!-- MODALE FAQ -->
  <div id="faqModal" class="modal hidden">
    <div class="modal-card">
      <div class="modal-head">
        <h2>üí¨ Foire aux questions</h2>
        <button id="faqClose" class="close">‚úï</button>
      </div>
      <div class="modal-body">
        <p><b>Quelle IA utilise Philom√®ne ?</b><br>
           Philom√®ne I.A. est propuls√©e par <b>GPT-5 Thinking</b>, la version la plus avanc√©e.</p>

        <p><b>Comment fonctionnent les tokens ?</b><br>
           Chaque message consomme quelques tokens selon la longueur.
           Le diamant üíé affiche votre solde.</p>

        <p><b>Packs disponibles</b><br>
           üíé 1 000 000 ‚Üí 5 ‚Ç¨<br>
           üíé 2 000 000 ‚Üí 10 ‚Ç¨<br>
           üíé 4 000 000 ‚Üí 20 ‚Ç¨<br>
           üéÅ Premier achat : <b>+50 % offerts</b>.</p>

        <p><b>Abonnement ?</b><br>
           Aucun. Vous payez uniquement ce que vous consommez.</p>
      </div>
    </div>
  </div>

  <script>
  const API_URL = "https://api.philomeneia.com/ask";
  const $ = s => document.querySelector(s);
  let tokenBalance = 1000000;
  let conversation = [{ role:"system", content:"Tu es Philom√®ne I.A., claire et utile." }];
  const chat = $("#chat"), input=$("#userInput");

  const setTokenCounter = n=>{
    $("#tokenCounter").textContent = new Intl.NumberFormat("fr-FR").format(Number(n||0));
  };
  setTokenCounter(tokenBalance);

  $("#menuBtn").onclick = e=>{
    e.stopPropagation(); $("#menuPanel").classList.toggle("hidden");
  };
  document.onclick = e=>{
    const m=$("#menuPanel"), b=$("#menuBtn");
    if (m && !m.contains(e.target) && e.target!==b) m.classList.add("hidden");
  };
  $("#openFaq").onclick = ()=>{$("#menuPanel").classList.add("hidden");$("#faqModal").classList.remove("hidden");};
  $("#faqClose").onclick = ()=>$("#faqModal").classList.add("hidden");
  $("#newChat").onclick = ()=>{
    conversation=[{ role:"system", content:"Tu es Philom√®ne I.A., claire et utile." }];
    chat.innerHTML='<div class="msg bot">Nouvelle discussion. Pose ta question üôÇ</div>';
  };

  const plus=$("#plusBtn"), stack=$("#attachStack");
  plus.onclick = e=>{
    e.stopPropagation();
    const open = stack.classList.toggle("hidden");
    plus.textContent=open?"+":"‚àí";
  };
  document.addEventListener("click",e=>{
    if(stack && !stack.contains(e.target)&&e.target!==plus){stack.classList.add("hidden");plus.textContent="+";}
  });
  $("#attachMic").onclick=()=>alert("Micro √† venir");
  $("#attachCam").onclick=()=>alert("Cam√©ra √† venir");
  $("#attachDoc").onclick=()=>alert("Document √† venir");

  $("#sendBtn").onclick = sendMessage;
  input.onkeydown = e=>{if(e.key==="Enter")sendMessage();};

  function appendMsg(role,text){
    const d=document.createElement("div");
    d.className=`msg ${role==="assistant"?"bot":"user"}`;
    d.innerHTML=text.replace(/\n/g,"<br>");
    chat.appendChild(d);
    chat.scrollTop=chat.scrollHeight;
  }

  async function sendMessage(){
    const text=input.value.trim(); if(!text)return;
    appendMsg("user",text); input.value="";
    conversation.push({role:"user",content:text});
    try{
      const r=await fetch(API_URL,{
        method:"POST",headers:{"Content-Type":"application/json"},
        body:JSON.stringify({conversation,userId:"guest",tokens:tokenBalance})
      });
      if(!r.ok)throw new Error();
      const d=await r.json();
      const ans=d.answer||"D√©sol√©, pas de r√©ponse.";
      appendMsg("assistant",ans);
      tokenBalance=d.tokensLeft??Math.max(0,tokenBalance-20-Math.ceil(ans.length/20));
      setTokenCounter(tokenBalance);
      conversation.push({role:"assistant",content:ans});
    }catch(e){appendMsg("assistant","‚ö†Ô∏è Erreur r√©seau. R√©essaie.");}
  }
  </script>
</body>
</html>
