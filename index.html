<!DOCTYPE html>
<html lang="fr" style="background:#000;">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PhilomÃ¨ne I.A.</title>
  <meta name="color-scheme" content="dark" />
  <style>
    body {
      margin:0;
      background:#000;
      color:#fff;
      font-family:-apple-system,BlinkMacSystemFont,"Inter",Roboto,"Helvetica Neue",Arial,sans-serif;
      display:flex;flex-direction:column;min-height:100vh;
    }
    header {
      background:#000;color:#ffd84f;border-bottom:1px solid rgba(255,255,255,0.08);
      padding:16px;display:flex;align-items:center;justify-content:space-between;
      font-size:16px;font-weight:500;
    }
    .left-head,.right-head{display:flex;align-items:center;gap:12px;color:#fff;}
    .burger,.more{width:40px;height:40px;background:#111;border:1px solid rgba(255,255,255,0.1);
      border-radius:8px;display:flex;align-items:center;justify-content:center;color:#fff;font-size:20px;font-weight:500;cursor:pointer;}
    .token-box{display:flex;flex-direction:column;align-items:center;font-size:14px;line-height:1.2;color:#ffd84f;font-weight:600;}
    .token-value{display:flex;align-items:center;gap:8px;}
    .token-label{font-size:12px;color:#888;font-weight:400;}
    .chat-wrapper{flex:1;display:flex;flex-direction:column;padding:16px;gap:16px;overflow-y:auto;
      background:radial-gradient(circle at 20% 20%, rgba(80,0,255,0.18) 0%, rgba(0,0,0,0) 60%);}
    .bubble{max-width:90%;border-radius:12px;padding:16px;line-height:1.4;font-size:18px;box-shadow:0 30px 60px rgba(0,0,0,0.6);border:1px solid rgba(255,255,255,0.08);}
    .bubble.assistant{align-self:flex-start;background:#2b2b2b;color:#fff;}
    .bubble.user{align-self:flex-end;background:#4c3bff;color:#fff;font-weight:500;border:1px solid rgba(255,255,255,0.15);
      box-shadow:0 0 40px rgba(100,60,255,0.6),0 30px 60px rgba(0,0,0,0.8);}
    .input-zone-wrapper{background:#000;border-top:1px solid rgba(255,255,255,0.08);padding:16px;}
    .input-row{display:flex;align-items:stretch;gap:12px;}
    .plus-btn,.send-btn{min-width:52px;min-height:52px;background:#1a0aff;border-radius:12px;
      border:1px solid rgba(255,255,255,0.15);box-shadow:0 0 30px rgba(120,80,255,0.8),0 30px 60px rgba(0,0,0,0.8);
      display:flex;align-items:center;justify-content:center;color:#fff;font-size:24px;line-height:0;font-weight:500;cursor:pointer;}
    .text-input{flex:1;background:#0f0f1a;border-radius:12px;border:1px solid rgba(255,255,255,0.25);
      font-size:18px;color:#fff;padding:16px;font-family:inherit;outline:none;}
    .status-line{text-align:center;margin-top:12px;font-size:15px;color:#999;font-weight:400;}
    .menu-dropdown{position:absolute;right:16px;top:64px;background:#111;border:1px solid rgba(255,255,255,0.1);
      border-radius:12px;display:none;flex-direction:column;min-width:240px;box-shadow:0 10px 40px rgba(0,0,0,0.6);}
    .menu-item{padding:14px 16px;font-size:15px;color:#fff;border-bottom:1px solid rgba(255,255,255,0.1);cursor:pointer;}
    .menu-item:last-child{border-bottom:none;}
    .menu-item:hover{background:#1a1a1a;}
    .thinking-bubble{font-size:16px;color:#ddd;background:#2b2b2b;}
    .modal-error{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background:#222;
      color:#fff;padding:16px 24px;border-radius:12px;border:1px solid rgba(255,255,255,0.2);box-shadow:0 20px 40px rgba(0,0,0,0.8);}
  </style>

  <script async crossorigin="anonymous" src="https://cdn.jsdelivr.net/npm/@clerk/clerk-js@latest"></script>
</head>
<body>

  <header>
    <div class="left-head"><div class="burger">â˜°</div></div>
    <div class="token-box">
      <div class="token-value">
        <div style="font-size:20px;">ðŸ’Ž</div><span id="token-count-top">5000</span><span>tokens</span>
      </div>
      <div class="token-label">PhilomÃ¨ne I.A.</div>
    </div>
    <div class="right-head"><div class="more" id="menu-btn">â‹¯</div></div>
  </header>

  <div id="dropdown" class="menu-dropdown">
    <div class="menu-item" id="menu-login">Connexion / Inscription</div>
    <div class="menu-item" style="opacity:.6;">Paiement (bientÃ´t)</div>
  </div>

  <div id="chat-container" class="chat-wrapper"></div>

  <div class="input-zone-wrapper">
    <div class="input-row">
      <div class="plus-btn">+</div>
      <input id="user-input" class="text-input" placeholder="Ã‰crivez votre message..." />
      <div id="send-btn" class="send-btn">âž¤</div>
    </div>
    <div class="status-line">PrÃªt â€¢ <strong><span id="token-count-bottom">5000</span> tokens</strong> restants</div>
  </div>

  <div id="error-modal" class="modal-error" style="display:none;">Connexion indisponible pour le moment.</div>

  <script>
    const API_URL = "https://philo-backend-su29.onrender.com/ask";
    let tokenCount = 5000;
    const chatContainer = document.getElementById("chat-container");
    const userInput = document.getElementById("user-input");
    const sendBtn = document.getElementById("send-btn");
    const tokenTop = document.getElementById("token-count-top");
    const tokenBottom = document.getElementById("token-count-bottom");
    const menuBtn = document.getElementById("menu-btn");
    const dropdown = document.getElementById("dropdown");
    const errorModal = document.getElementById("error-modal");

    let conversation = JSON.parse(localStorage.getItem("conversation")) || [
      { role:"system", content:"Tu es PhilomÃ¨ne I.A., une assistante personnelle en franÃ§ais, calme et humaine." },
      { role:"assistant", content:"ðŸ‘‹ Bonjour ! Je suis PhilomÃ¨ne I.A., votre assistante personnelle.\nSi vous avez un problÃ¨me, jâ€™ai la solution.\nVous avez une question, jâ€™ai la rÃ©ponse.\nEnsemble, on ira plus loin ðŸ•Š" }
    ];

    function scrollToBottom(){ chatContainer.scrollTop = chatContainer.scrollHeight; }
    function addBubble(text, who){
      const div=document.createElement("div");div.classList.add("bubble");
      if(who==="user")div.classList.add("user");else div.classList.add("assistant");
      div.textContent=text;chatContainer.appendChild(div);scrollToBottom();return div;
    }
    function updateTokens(){ tokenTop.textContent=tokenCount; tokenBottom.textContent=tokenCount; }

    function initConversation(){
      chatContainer.innerHTML="";conversation.forEach(m=>{if(m.role!=="system")addBubble(m.content,m.role);});
      updateTokens();scrollToBottom();
    }
    initConversation();

    async function askPhilomene(){
      const text=userInput.value.trim();if(!text)return;
      addBubble(text,"user");conversation.push({role:"user",content:text});
      userInput.value="";const thinking=addBubble("PhilomÃ¨ne rÃ©flÃ©chit...","assistant");
      try{
        const r=await fetch(API_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation})});
        const d=await r.json();thinking.remove();addBubble(d.answer||"â€¦","assistant");
        conversation.push({role:"assistant",content:d.answer||""});
        tokenCount=Math.max(0,tokenCount-20);updateTokens();
        localStorage.setItem("conversation",JSON.stringify(conversation));
      }catch(e){thinking.textContent="DÃ©solÃ©e, jâ€™ai eu un souci de connexion.";}
    }
    sendBtn.onclick=askPhilomene;
    userInput.addEventListener("keydown",e=>{if(e.key==="Enter"){e.preventDefault();askPhilomene();}});

    menuBtn.onclick=()=>{dropdown.style.display=dropdown.style.display==="flex"?"none":"flex";};
    window.onclick=e=>{if(!menuBtn.contains(e.target)&&!dropdown.contains(e.target))dropdown.style.display="none";};

    async function openClerk(){
      try{
        const clerkPubKey="pk_test_ZW5vdWdoLXRyZWVmcm9nLTIuY2xlcmsuYWNjb3VudHMuZGV2JA";
        window.Clerk.load({publishableKey:clerkPubKey});
        await window.Clerk.load();
        window.Clerk.openSignIn();
      }catch(err){
        errorModal.style.display="block";
        setTimeout(()=>errorModal.style.display="none",4000);
      }
    }
    document.getElementById("menu-login").onclick=openClerk;
  </script>
</body>
</html>
