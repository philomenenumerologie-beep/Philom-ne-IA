<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1" />
  <title>Philom√®ne I.A.</title>
  <meta name="color-scheme" content="dark light" />

  <style>
    :root{
      --bg:#0f0f12;
      --card:#17171c;
      --card-2:#1d1d23;
      --text:#e9e9f1;
      --sub:#a7a7bb;
      --accent:#6c63ff;
      --accent-2:#7e75ff;
      --line:#2a2a33;
      --pill:#1b1b22;
      --shadow: 0 12px 40px rgba(0,0,0,.45);
      --radius:18px;
    }
    [data-theme="light"]{
      --bg:#f7f7fb;
      --card:#ffffff;
      --card-2:#ffffff;
      --text:#191922;
      --sub:#4a4a5e;
      --accent:#5c52ff;
      --accent-2:#695fff;
      --line:#e8e8f2;
      --pill:#f0f0f8;
      --shadow: 0 12px 30px rgba(0,0,0,.06);
    }
    html,body{height:100%}
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;
      -webkit-font-smoothing:antialiased;
    }
    .page{
      min-height:100dvh;
      padding: env(safe-area-inset-top) 12px calc(16px + env(safe-area-inset-bottom));
      display:flex; flex-direction:column;
      gap:14px;
    }

    /* Header */
    .topbar{
      display:flex; align-items:center; justify-content:space-between;
      gap:10px; padding:8px 6px;
    }
    .brand{
      display:flex; align-items:center; gap:10px; min-width:0;
    }
    .brand .heart{font-size:22px; opacity:.9}
    .title{font-weight:800; font-size:22px; letter-spacing:.2px}
    .right{
      display:flex; align-items:center; gap:10px;
      margin-left:auto;
    }
    .pill{
      background:var(--pill);
      border:1px solid var(--line);
      border-radius:14px;
      padding:8px 12px;
      display:flex; align-items:center; gap:8px;
      box-shadow:var(--shadow);
      white-space:nowrap;
    }
    .pill .moon{font-size:18px}
    .pill .diamond{font-size:18px}
    .link-pill{
      background:transparent; border:1px solid var(--line);
      color:var(--text); text-decoration:none; border-radius:14px;
      padding:8px 12px; font-weight:600;
    }
    .burger{
      width:34px; height:34px; border-radius:12px;
      display:grid; place-items:center; background:var(--pill);
      border:1px solid var(--line);
    }
    .menu{
      position:fixed; right:12px; top:56px; z-index:20;
      background:var(--card); border:1px solid var(--line);
      border-radius:14px; box-shadow:var(--shadow);
      overflow:hidden; display:none; min-width:210px;
    }
    .menu.open{display:block}
    .menu button{
      width:100%; text-align:left; background:transparent; color:var(--text);
      border:0; padding:12px 14px; display:flex; gap:8px; align-items:center;
    }
    .menu button + button{border-top:1px solid var(--line)}

    /* Chat list */
    .chat{
      flex:1 1 auto;
      display:flex; flex-direction:column; gap:10px;
      overflow:auto; scroll-padding-bottom:140px;
    }
    .bubble{
      background:var(--card); border:1px solid var(--line);
      border-radius:18px; padding:14px 16px; box-shadow:var(--shadow);
      max-width:92%;
    }
    .bubble.me{
      align-self:flex-end; background:var(--accent);
      color:white; border-color:transparent;
    }

    /* Composer */
    .composer-wrap{
      position:sticky; bottom:0; left:0; right:0;
      padding-top:6px; background:linear-gradient(180deg, transparent, rgba(0,0,0,.12));
      backdrop-filter:saturate(160%) blur(2px);
    }
    .composer{
      display:flex; align-items:center; gap:10px;
      padding:6px 0 2px;
    }
    .plus{
      width:46px; height:46px; border-radius:16px;
      background:var(--pill); border:1px solid var(--line);
      display:grid; place-items:center; font-size:22px; font-weight:700;
      color:var(--text);
      position:relative; z-index:2;
    }
    .attachments{
      position:absolute; bottom:54px; /* au-dessus du + */
      left:6px;
      display:flex; flex-direction:column; gap:10px;
      transition:opacity .15s, transform .18s;
      opacity:0; pointer-events:none; transform:translateY(6px);
    }
    .attachments.open{opacity:1; pointer-events:auto; transform:translateY(0)}
    .att-btn{
      background:var(--card-2); border:1px solid var(--line);
      color:var(--text); border-radius:14px; padding:12px 14px;
      display:flex; gap:10px; align-items:center; min-width:180px;
      box-shadow:var(--shadow);
    }
    .input{
      flex:1; background:var(--card); border:1px solid var(--line);
      border-radius:16px; padding:12px 14px; color:var(--text);
      outline:none;
    }
    .send{
      width:64px; height:48px; border-radius:16px;
      background:var(--accent); border:0; color:white; font-weight:800;
      box-shadow:0 10px 22px rgba(108,99,255,.35);
    }
    .powered{
      color:var(--sub); font-weight:700; letter-spacing:.2px;
      display:flex; gap:8px; align-items:center; justify-content:center;
      margin-top:6px;
    }

    /* Utiles */
    .muted{color:var(--sub)}
    .hide{display:none}
    .nowrap{white-space:nowrap}

    /* iOS: √©viter le zoom sur focus */
    input,button{font-size:16px}

  </style>
</head>
<body data-theme="dark">
  <div class="page">

    <!-- HEADER -->
    <header class="topbar">
      <div class="brand">
        <div class="heart">ü§ç</div>
        <div class="title">Philom√®ne<br/>I.A.</div>
      </div>

      <div class="right">
        <button id="themeBtn" class="pill" aria-label="Basculer th√®me">
          <span class="moon">üåô</span>
        </button>

        <div class="pill" id="tokenPill" aria-label="Solde">
          <span class="diamond">üíé</span>
          <span id="tokenCount" class="nowrap">1 000 000</span>
        </div>

        <a class="link-pill" href="#" id="loginLink">Connexion / Inscription</a>

        <button class="burger" id="burgerBtn" aria-label="Menu">
          <span style="font-size:18px">‚â°</span>
        </button>
        <div class="menu" id="menu">
          <button id="faqBtn">‚ùì FAQ</button>
          <button id="newBtn">üîÑ Nouvelle discussion</button>
        </div>
      </div>
    </header>

    <!-- CHAT -->
    <main class="chat" id="chat">
      <div class="bubble">
        Bonjour üëã Je suis Philom√®ne I.A., propuls√©e par <b>GPT-5 Thinking</b>.
      </div>
    </main>

    <!-- COMPOSER -->
    <div class="composer-wrap">
      <div class="composer">
        <button class="plus" id="plusBtn" aria-expanded="false">+</button>

        <!-- menu attachs qui MONTE au-dessus du + -->
        <div class="attachments" id="attachments" aria-hidden="true">
          <button class="att-btn" id="micBtn">üéôÔ∏è Micro</button>
          <button class="att-btn" id="camBtn">üì∑ Appareil photo</button>
          <button class="att-btn" id="docBtn">üìÑ Document</button>
        </div>

        <input id="msg" class="input" placeholder="√âcrivez votre message‚Ä¶" autocomplete="off" />
        <button class="send" id="sendBtn">‚û§</button>
      </div>
      <div class="powered">‚öôÔ∏è <span>Propuls√© par <b>GPT-5 Thinking</b></span></div>
    </div>

  </div>

  <script>
    // ---------- CONFIG DEMO ----------
    const COST_PER_MSG = 120;        // d√©mo: co√ªt fixe par message
    const COST_PER_CHAR = 1;         // + 1 token par caract√®re (d√©mo)
    let tokenBalance = 1000000;      // valeur affich√©e dans la pastille

    // ---------- UI ----------
    const chat = document.getElementById('chat');
    const msg  = document.getElementById('msg');
    const send = document.getElementById('sendBtn');
    const plus = document.getElementById('plusBtn');
    const atts = document.getElementById('attachments');
    const tokenCount = document.getElementById('tokenCount');

    const burgerBtn = document.getElementById('burgerBtn');
    const menu = document.getElementById('menu');
    const themeBtn = document.getElementById('themeBtn');

    function formatNb(n){
      // 1 000 000 style FR
      return n.toLocaleString('fr-FR');
    }
    function updateTokensDisplay(){
      tokenCount.textContent = formatNb(Math.max(0, tokenBalance));
    }
    updateTokensDisplay();

    function addBubble(text, me=false){
      const b = document.createElement('div');
      b.className = 'bubble' + (me ? ' me' : '');
      b.textContent = text;
      chat.appendChild(b);
      // autoscroll
      chat.scrollTo({top: chat.scrollHeight, behavior: 'smooth'});
    }

    function spendTokensFor(text){
      const spent = COST_PER_MSG + (text?.length || 0) * COST_PER_CHAR;
      tokenBalance = Math.max(0, tokenBalance - spent);
      updateTokensDisplay();
    }

    // Envoi d√©mo (simule la r√©ponse)
    async function handleSend(){
      const text = msg.value.trim();
      if(!text) return;
      addBubble(text, true);
      spendTokensFor(text);
      msg.value = '';

      // Simule une petite r√©ponse
      setTimeout(()=>{
        addBubble('OK.');
        // On simule aussi la d√©pense r√©ponse
        spendTokensFor('OK.');
      }, 400);
    }

    send.addEventListener('click', handleSend);
    msg.addEventListener('keydown', (e)=>{
      if(e.key === 'Enter'){
        e.preventDefault();
        handleSend();
      }
    });

    // Plus / Moins & attachs (montent au-dessus)
    function toggleAtts(force){
      const open = force ?? !atts.classList.contains('open');
      if(open){
        atts.classList.add('open');
        plus.textContent = '‚àí';
        plus.setAttribute('aria-expanded','true');
        atts.setAttribute('aria-hidden','false');
      }else{
        atts.classList.remove('open');
        plus.textContent = '+';
        plus.setAttribute('aria-expanded','false');
        atts.setAttribute('aria-hidden','true');
      }
    }
    plus.addEventListener('click', ()=>toggleAtts());

    // Fermer les attachs si on tape dans l‚Äôinput
    msg.addEventListener('focus', ()=>toggleAtts(false));

    // Burger menu
    burgerBtn.addEventListener('click', ()=>{
      menu.classList.toggle('open');
    });
    document.addEventListener('click', (e)=>{
      if(!menu.contains(e.target) && e.target !== burgerBtn){
        menu.classList.remove('open');
      }
    });

    // Th√®me (jour/nuit)
    themeBtn.addEventListener('click', ()=>{
      const cur = document.body.getAttribute('data-theme');
      document.body.setAttribute('data-theme', cur === 'dark' ? 'light' : 'dark');
    });

    // iOS: emp√™cher le ‚Äúsaut d‚Äô√©cran‚Äù quand le clavier sort
    // (on garde la hauteur de la page stable)
    if ('virtualKeyboard' in navigator) {
      navigator.virtualKeyboard.overlaysContent = true;
    }

    // Boutons attach (d√©mo)
    document.getElementById('micBtn').addEventListener('click', ()=>addBubble('üéôÔ∏è (micro)'));
    document.getElementById('camBtn').addEventListener('click', ()=>addBubble('üì∑ (photo)'));
    document.getElementById('docBtn').addEventListener('click', ()=>addBubble('üìÑ (document)'));

    // FAQ / New chat (d√©mo)
    document.getElementById('faqBtn').addEventListener('click', ()=>{
      addBubble('FAQ :\n‚Ä¢ GPT-5 Thinking\n‚Ä¢ Packs 1M/2M/4M\n‚Ä¢ +50% au 1er achat');
      menu.classList.remove('open');
    });
    document.getElementById('newBtn').addEventListener('click', ()=>{
      chat.innerHTML = '';
      addBubble('Bonjour üëã Je suis Philom√®ne I.A., propuls√©e par GPT-5 Thinking.');
      menu.classList.remove('open');
    });
  </script>
</body>
</html>
