<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>PhilomÃ¨ne I.A.</title>
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Ctext y='52' x='6' font-size='56'%3EğŸ’%3C/text%3E%3C/svg%3E">
<style>
  :root{
    --bg:#0c0c0e; --panel:#121218; --panel2:#181824; --text:#f2f2f5; --muted:#bcbcd2;
    --brand:#8b5cf6; --brand-2:#a78bfa; --accent:#a78bfa; --stroke:#2a2a3a;
    --bubble-user:#1e1e2a; --bubble-bot:#151524;
  }
  body.light{
    --bg:#ffffff; --panel:#f7f7fb; --panel2:#f1f1f8; --text:#16161a; --muted:#4b4b5e;
    --brand:#7c3aed; --brand-2:#6d28d9; --accent:#6d28d9; --bubble-user:#eef; --bubble-bot:#fff; --stroke:#e8e8ef;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--text);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Inter,sans-serif}
  /* Topbar */
  .topbar{position:sticky;top:0;z-index:40;display:flex;align-items:center;gap:.6rem;
    padding:.8rem 1rem;border-bottom:1px solid var(--stroke);background:linear-gradient(180deg,var(--panel),var(--panel2))}
  .brand{display:flex;align-items:center;gap:.6rem;font-weight:750;font-size:1.08rem}
  .dot{width:.55rem;height:.55rem;border-radius:50%;background:#8b5cf6;box-shadow:0 0 0 3px rgba(139,92,246,.25)}
  .spacer{flex:1}
  .topbtn{margin-left:.4rem;padding:.35rem .6rem;border:1px solid var(--stroke);border-radius:.55rem;background:transparent;color:var(--text);font-weight:700}
  .topbtn.buy{border-color:var(--accent)}
  .moon{cursor:pointer;font-size:1.05rem}
  .counter{display:flex;align-items:center;gap:.35rem;font-weight:800;color:#c7b8ff}
  .counter .d{font-size:1.1rem}
  .menu{cursor:pointer;font-size:1.2rem;padding:.2rem .3rem;border-radius:.5rem}
  /* Chat */
  .chat{height:calc(100dvh - 152px);overflow:auto;padding:1rem;scroll-behavior:smooth}
  .bubble{max-width:min(680px,92%);border:1px solid var(--stroke);border-radius:16px;padding:.9rem 1rem;margin:.4rem 0}
  .bot{background:var(--bubble-bot)}
  .me{background:var(--bubble-user);margin-left:auto}
  /* Composer */
  .composer{position:sticky;bottom:0;z-index:30;padding:.7rem .8rem 1rem;border-top:1px solid var(--stroke);
    background:linear-gradient(180deg,var(--panel2),var(--panel))}
  .row{display:flex;align-items:center;gap:.6rem}
  .btn{border:none;background:transparent;color:var(--text);cursor:pointer}
  .btn.icon{width:42px;height:42px;display:grid;place-items:center;border-radius:10px;border:1px solid var(--stroke)}
  .inputWrap{flex:1;display:flex;align-items:center;gap:.55rem;border:1px solid var(--stroke);background:var(--bg);
    border-radius:12px;padding:.55rem .7rem}
  .inputWrap input{flex:1;border:none;outline:none;background:transparent;color:var(--text);font:inherit}
  .send{background:var(--brand);color:white;border:none;border-radius:12px;padding:.65rem .9rem;font-weight:700}
  .foot{display:flex;gap:.5rem;align-items:center;justify-content:center;color:var(--muted);font-size:.92rem;margin:.55rem 0}
  .foot strong{color:#c9a7ff}
  /* Plus sheet */
  .sheetBg{position:fixed;inset:0;background:rgba(0,0,0,.35);backdrop-filter:blur(2px);display:none}
  .sheet{position:fixed;left:0;right:0;bottom:0;transform:translateY(110%);transition:.28s ease;z-index:41}
  .sheetInner{background:var(--panel2);border-top:1px solid var(--stroke);border-radius:16px 16px 0 0;padding:1rem}
  .pickGrid{display:grid;grid-template-columns:1fr;gap:.6rem}
  .pick{display:flex;align-items:center;gap:.7rem;border:1px solid var(--stroke);padding:.8rem;border-radius:12px;cursor:pointer}
  .pick:hover{border-color:var(--brand)}
  /* FAQ modal */
  .modalBg{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;z-index:60}
  .modal{position:fixed;inset:0;display:grid;place-items:center;z-index:61}
  .card{width:min(680px,92%);max-height:86dvh;overflow:auto;background:var(--panel);border:1px solid var(--stroke);
    border-radius:18px;padding:1rem 1.1rem 1.2rem;box-shadow:0 12px 40px rgba(0,0,0,.45)}
  .card h2{margin:.3rem 0 1rem;font-size:1.6rem;color:#c9a7ff}
  .packs{display:grid;gap:.6rem;margin:.6rem 0 1rem}
  .pack{display:flex;align-items:center;justify-content:space-between;border:1px solid var(--stroke);padding:.9rem 1rem;border-radius:12px}
  .gift{margin:.6rem 0 0;padding:.75rem 1rem;border-radius:12px;background:rgba(139,92,246,.12);border:1px solid var(--stroke)}
  /* Auth/Pay modals */
  .modalWrap[hidden]{display:none}
  .modalWrap{position:fixed;inset:0;z-index:70}
  .mBg{position:absolute;inset:0;background:rgba(0,0,0,.45);backdrop-filter:blur(4px)}
  .mPanel{position:relative;margin:7vh auto 0;max-width:520px;background:var(--panel2);border:1px solid var(--stroke);
    border-radius:14px;padding:16px;box-shadow:0 10px 40px rgba(0,0,0,.35)}
  .mHead{display:flex;align-items:center;justify-content:space-between}
  .mHead h3{margin:0}
  .mClose{font-size:1.3rem;background:transparent;border:none;color:var(--text);cursor:pointer}
  .mBody{margin-top:10px;display:grid;gap:10px}
  .mBody input{width:100%;padding:.7rem .8rem;border-radius:.6rem;border:1px solid var(--stroke);background:var(--panel);color:var(--text)}
  .mActions{display:flex;justify-content:flex-end;gap:.6rem;margin-top:12px}
  .btnSolid{padding:.6rem 1rem;border-radius:.6rem;border:none;color:#fff;background:var(--brand)}
  .btnGhost{padding:.6rem 1rem;border-radius:.6rem;border:1px solid var(--stroke);background:transparent;color:var(--text)}
  .packRow{display:flex;align-items:center;gap:.6rem;padding:.5rem;border-radius:.6rem;background:var(--panel);border:1px solid var(--stroke)}
  .bonus{margin:.4rem 0 0;color:var(--accent)}
</style>
</head>
<body class="dark">
  <!-- HEADER -->
  <div class="topbar">
    <div class="brand"><span class="dot"></span> PhilomÃ¨ne I.A.</div>
    <div class="spacer"></div>

    <!-- nouveaux boutons -->
    <button id="loginBtn" class="topbtn">Connexion</button>
    <button id="payBtn" class="topbtn buy">Acheter ğŸ’</button>

    <div id="toggleMode" class="moon" title="Jour / Nuit">ğŸŒ™</div>
    <div class="counter" title="Solde tokens"><span class="d">ğŸ’</span><span id="tokenCount">1 000 000</span></div>
    <div id="openMenu" class="menu" title="FAQ">â“</div>
  </div>

  <!-- CHAT -->
  <div id="chat" class="chat">
    <div class="bubble bot">Bonjour ğŸ‘‹ Je suis PhilomÃ¨ne I.A., propulsÃ©e par GPT-5 Thinking.</div>
  </div>

  <!-- COMPOSER -->
  <div class="composer">
    <div class="row">
      <button id="plusBtn" class="btn icon" title="Plus">ï¼‹</button>
      <div class="inputWrap">
        <input id="userInput" placeholder="Ã‰crivez votre messageâ€¦" autocomplete="off" />
        <button id="micBtn" class="btn" title="Dicter">ğŸ¤</button>
      </div>
      <button id="sendBtn" class="send" title="Envoyer">â¤</button>
    </div>
    <div class="foot">âš™ï¸ PropulsÃ© par <strong>GPT-5 Thinking</strong> â€” la version la plus avancÃ©e de PhilomÃ¨ne I.A.</div>
  </div>

  <!-- PLUS SHEET -->
  <div id="sheetBg" class="sheetBg"></div>
  <div id="sheet" class="sheet">
    <div class="sheetInner">
      <div class="pickGrid">
        <div id="pickLibrary" class="pick">ğŸ–¼ï¸ PhotothÃ¨que</div>
        <div id="pickCamera" class="pick">ğŸ“· Prendre une photo</div>
        <div id="pickDoc" class="pick">ğŸ“„ Choisir un fichier</div>
      </div>
    </div>
  </div>

  <!-- Hidden inputs -->
  <input id="imgLibrary" type="file" accept="image/*" />
  <input id="imgCamera"  type="file" accept="image/*" capture="environment" />
  <input id="docInput"   type="file" accept="image/*,application/pdf" />

  <!-- FAQ -->
  <div id="faqBg" class="modalBg"></div>
  <div id="faqModal" class="modal" aria-hidden="true" style="display:none">
    <div class="card">
      <h2>ğŸ’¬ Foire aux questions</h2>
      <h3>Quelle IA utilise PhilomÃ¨ne ?</h3>
      <p>PhilomÃ¨ne I.A. est propulsÃ©e par <strong>GPT-5 Thinking</strong>.</p>
      <h3>Comment fonctionnent les tokens ?</h3>
      <p>Chaque question + rÃ©ponse consomment des tokens selon leur longueur. Le diamant ğŸ’ affiche votre solde.</p>
      <h3>Packs disponibles</h3>
      <div class="packs">
        <div class="pack">ğŸ’ 1 000 000 tokens â†’ 5 â‚¬</div>
        <div class="pack">ğŸ’ 2 000 000 tokens â†’ 10 â‚¬</div>
        <div class="pack">ğŸ’ 4 000 000 tokens â†’ 20 â‚¬</div>
      </div>
      <div class="gift">ğŸ <strong>Premier achat : +50 % offerts</strong> (1,5 M Â· 3 M Â· 6 M)</div>
      <h3>Abonnement ?</h3><p>Non. Toute la puissance de GPT-5, sans abonnement.</p>
      <h3>ConfidentialitÃ©</h3><p>Vos Ã©changes restent privÃ©s.</p>
      <div class="row" style="justify-content:flex-end;margin-top:.8rem">
        <button id="closeFaq" class="btn icon">âœ•</button>
      </div>
    </div>
  </div>

  <!-- MODALE CONNEXION -->
  <div id="loginModal" class="modalWrap" hidden>
    <div class="mBg" data-close="loginModal"></div>
    <div class="mPanel">
      <div class="mHead">
        <h3>Connexion</h3>
        <button class="mClose" data-close="loginModal">Ã—</button>
      </div>
      <div class="mBody">
        <label for="loginEmail">Email</label>
        <input id="loginEmail" type="email" placeholder="ton@email.com">
        <label for="loginCode">Code (optionnel)</label>
        <input id="loginCode" type="text" placeholder="ReÃ§u par email/SMS">
        <p class="hint">Pas de compte ? La connexion invitÃ©e reste active.</p>
      </div>
      <div class="mActions">
        <button class="btnGhost" data-close="loginModal">Annuler</button>
        <button id="loginSubmit" class="btnSolid">Se connecter</button>
      </div>
    </div>
  </div>

  <!-- MODALE PAIEMENT -->
  <div id="payModal" class="modalWrap" hidden>
    <div class="mBg" data-close="payModal"></div>
    <div class="mPanel">
      <div class="mHead">
        <h3>Acheter des tokens ğŸ’</h3>
        <button class="mClose" data-close="payModal">Ã—</button>
      </div>
      <div class="mBody">
        <label>Packs</label>
        <div class="packRow"><input type="radio" name="pack" value="1000000" checked> ğŸ’ 1 000 000 â€” 5 â‚¬</div>
        <div class="packRow"><input type="radio" name="pack" value="2000000">     ğŸ’ 2 000 000 â€” 10 â‚¬</div>
        <div class="packRow"><input type="radio" name="pack" value="4000000">     ğŸ’ 4 000 000 â€” 20 â‚¬</div>
        <p class="bonus">ğŸ Premier achat : <b>+50%</b> offerts</p>
      </div>
      <div class="mActions">
        <button class="btnGhost" data-close="payModal">Annuler</button>
        <button id="paySubmit" class="btnSolid">Payer avec PayPal</button>
      </div>
    </div>
  </div>

<script>
(() => {
  // ===== CONFIG
  const API_URL = "https://api.philomeneia.com/ask";
  const API_IMG = "https://api.philomeneia.com/analyze-image";
  const DEFAULT_TOKENS = 1_000_000;

  // ===== STATE
  let tokenCount = Number(localStorage.getItem("tokens") || DEFAULT_TOKENS);
  let theme = localStorage.getItem("theme") || "dark";
  let recognition = null;
  const userId = localStorage.getItem("userId") || ("guest_" + Math.random().toString(36).slice(2,8));
  localStorage.setItem("userId", userId);

  // ===== DOM
  const chat = document.getElementById("chat");
  const tokenCountEl = document.getElementById("tokenCount");
  const userInput = document.getElementById("userInput");
  const sendBtn = document.getElementById("sendBtn");
  const plusBtn = document.getElementById("plusBtn");
  const micBtn = document.getElementById("micBtn");
  const toggleMode = document.getElementById("toggleMode");
  const menuBtn = document.getElementById("openMenu");

  const sheetBg = document.getElementById("sheetBg");
  const sheet = document.getElementById("sheet");
  const pickLibrary = document.getElementById("pickLibrary");
  const pickCamera = document.getElementById("pickCamera");
  const pickDoc = document.getElementById("pickDoc");
  const imgLibrary = document.getElementById("imgLibrary");
  const imgCamera = document.getElementById("imgCamera");
  const docInput = document.getElementById("docInput");

  const faqBg = document.getElementById("faqBg");
  const faqModal = document.getElementById("faqModal");
  const closeFaq = document.getElementById("closeFaq");

  // Auth/Pay
  const loginBtn = document.getElementById('loginBtn');
  const payBtn   = document.getElementById('payBtn');
  const loginModal = document.getElementById('loginModal');
  const payModal   = document.getElementById('payModal');
  const loginSubmit= document.getElementById('loginSubmit');
  const paySubmit  = document.getElementById('paySubmit');

  // ===== INIT
  if(theme === "light"){ document.body.classList.remove("dark"); document.body.classList.add("light"); }
  updateTokens();
  addMessage("Bonjour ğŸ‘‹ Je suis PhilomÃ¨ne I.A., propulsÃ©e par GPT-5 Thinking.","bot");

  // ===== Helpers
  function addMessage(text, who="bot"){
    const b = document.createElement("div");
    b.className = "bubble " + (who === "me" ? "me":"bot");
    b.textContent = text;
    chat.appendChild(b);
    chat.scrollTop = chat.scrollHeight;
  }
  function setTyping(on){
    if(on){
      const t=document.createElement("div");
      t.className="bubble bot"; t.id="typing"; t.textContent="â€¦";
      chat.appendChild(t); chat.scrollTop=chat.scrollHeight;
    }else{
      document.getElementById("typing")?.remove();
    }
  }
  function updateTokens(){
    tokenCountEl.textContent = tokenCount.toLocaleString("fr-FR");
    localStorage.setItem("tokens", tokenCount);
  }

  // ===== Theme
  toggleMode.addEventListener("click", () => {
    const isDark = document.body.classList.contains("dark");
    document.body.classList.toggle("dark", !isDark);
    document.body.classList.toggle("light", isDark);
    localStorage.setItem("theme", isDark ? "light" : "dark");
  });

  // ===== Send
  async function sendText(){
    const msg = (userInput.value || "").trim();
    if(!msg) return;
    addMessage(msg,"me"); userInput.value="";

    tokenCount = Math.max(0, tokenCount - (20 + Math.ceil(msg.length/12))); updateTokens();

    setTyping(true);
    try{
      const resp = await fetch(API_URL,{
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify({ userId, conversation:[{role:"user", content:msg}] })
      });
      const data = await resp.json();
      setTyping(false);
      const answer = data?.answer || "DÃ©solÃ©e, je nâ€™ai pas pu rÃ©pondre.";
      addMessage(answer,"bot");
      tokenCount = Math.max(0, tokenCount - Math.ceil(answer.length/14)); updateTokens();
    }catch{ setTyping(false); addMessage("Erreur rÃ©seau.","bot"); }
  }
  sendBtn.addEventListener("click", sendText);
  userInput.addEventListener("keydown", e=>{ if(e.key==="Enter" && !e.shiftKey){ e.preventDefault(); sendText(); }});

  // ===== Mic
  micBtn.addEventListener("click", () => {
    const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
    if(!SR){ alert("La dictÃ©e vocale nâ€™est pas disponible sur ce navigateur."); return; }
    if(window.__rec){ try{window.__rec.stop();}catch{}; window.__rec=null; return; }
    const rec=new SR(); window.__rec=rec;
    rec.lang="fr-FR"; rec.interimResults=false; rec.maxAlternatives=1;
    rec.onresult=(ev)=>{ const txt=ev.results[0][0].transcript||""; userInput.value=(userInput.value?userInput.value+" ":"")+txt; };
    rec.onend=()=>{ window.__rec=null; };
    rec.start();
  });

  // ===== Sheet
  function openSheet(){ sheetBg.style.display="block"; sheet.style.transform="translateY(0)"; sheet.style.display="block"; }
  function closeSheet(){ sheet.style.transform="translateY(110%)"; setTimeout(()=>{ sheet.style.display=""; sheetBg.style.display="none"; },280); }
  plusBtn.addEventListener("click", openSheet);
  sheetBg.addEventListener("click", closeSheet);

  pickLibrary.addEventListener("click", ()=> imgLibrary.click());
  pickCamera .addEventListener("click", ()=> imgCamera.click());
  pickDoc    .addEventListener("click", ()=> docInput.click());

  imgLibrary.addEventListener("change", e=> handleFile(e.target.files?.[0]));
  imgCamera .addEventListener("change", e=> handleFile(e.target.files?.[0]));
  docInput  .addEventListener("change", e=> handleFile(e.target.files?.[0]));

  async function handleFile(file){
    closeSheet(); if(!file) return;
    const form = new FormData();
    form.append("image", file);
    form.append("userId", userId);
    form.append("prompt", "Analyse ce fichier / cette image et explique clairement.");
    setTyping(true);
    try{
      const r = await fetch("https://api.philomeneia.com/analyze-image",{ method:"POST", body:form });
      const d = await r.json();
      setTyping(false);
      const answer = d?.answer || "Fichier reÃ§u, mais pas dâ€™analyse disponible.";
      addMessage(answer,"bot");
      tokenCount = Math.max(0, tokenCount - Math.ceil((answer.length||80)/12)); updateTokens();
    }catch{ setTyping(false); addMessage("Erreur lors de lâ€™envoi du fichier.","bot"); }
    imgLibrary.value=""; imgCamera.value=""; docInput.value="";
  }

  // ===== FAQ
  function openFaq(){ faqBg.style.display="block"; faqModal.style.display="grid"; faqModal.setAttribute("aria-hidden","false"); }
  function closeFaq(){ faqBg.style.display="none";  faqModal.style.display="none";  faqModal.setAttribute("aria-hidden","true"); }
  menuBtn.addEventListener("click", openFaq);
  faqBg.addEventListener("click", closeFaq);
  closeFaq.addEventListener("click", closeFaq);

  // ===== Connexion (local only, pour valider lâ€™UI)
  loginBtn.addEventListener('click', ()=> open(loginModal));
  payBtn  .addEventListener('click', ()=> open(payModal));

  function open(modal){ modal.hidden=false; }
  function close(modal){ modal.hidden=true; }
  document.addEventListener('click',(e)=>{
    const id=e.target?.dataset?.close;
    if(id){ const m=document.getElementById(id); if(m) close(m); }
  });
  document.addEventListener('keydown',(e)=>{
    if(e.key==='Escape'){ [loginModal,payModal].forEach(m=>!m.hidden&&close(m)); }
  });

  loginSubmit.addEventListener('click', ()=>{
    const email = document.getElementById('loginEmail')?.value?.trim();
    if(email){ localStorage.setItem("userEmail", email); addMessage(`ConnectÃ© : ${email} âœ…`,"bot"); }
    else { addMessage("Connexion invitÃ©e activÃ©e âœ…","bot"); }
    close(loginModal);
  });

  paySubmit.addEventListener('click', ()=>{
    const v = document.querySelector('input[name="pack"]:checked')?.value || "1000000";
    addMessage(`Paiement dÃ©marrÃ© pour ${Number(v).toLocaleString("fr-FR")} tokens (simulation).`,"bot");
    close(payModal);
  });
})();
</script>
</body>
</html>
