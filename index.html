<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Philom√®ne I.A.</title>
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Ctext y='52' x='6' font-size='56'%3Eüíé%3C/text%3E%3C/svg%3E">
<style>
  :root{
    --bg:#0c0c0e; --panel:#121218; --panel2:#181824; --text:#f2f2f5; --muted:#bcbcd2;
    --brand:#8b5cf6; --brand-2:#a78bfa; --ok:#22c55e; --ring: 0 0 0 2px rgba(139,92,246,.45);
    --bubble-user:#1e1e2a; --bubble-bot:#151524; --stroke:#2a2a3a;
  }
  body.light{
    --bg:#ffffff; --panel:#f7f7fb; --panel2:#f1f1f8; --text:#16161a; --muted:#4b4b5e;
    --brand:#7c3aed; --brand-2:#6d28d9; --bubble-user:#eef; --bubble-bot:#fff; --stroke:#e8e8ef;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--text);font:16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Inter, sans-serif;}
  /* Header */
  .topbar{position:sticky;top:0;z-index:40;display:flex;align-items:center;gap:.75rem;
    padding:.9rem 1rem;border-bottom:1px solid var(--stroke);background:linear-gradient(180deg,var(--panel),var(--panel2));}
  .brand{display:flex;align-items:center;gap:.6rem;font-weight:750;font-size:1.1rem;letter-spacing:.2px}
  .dot{width:.55rem;height:.55rem;border-radius:50%;background:#8b5cf6;box-shadow:0 0 0 3px rgba(139,92,246,.25);}
  .spacer{flex:1}
  .moon{cursor:pointer;font-size:1.15rem;filter:drop-shadow(0 0 6px rgba(0,0,0,.25))}
  .counter{display:flex;align-items:center;gap:.45rem;font-weight:800;color:#c7b8ff}
  .counter .d{font-size:1.15rem}
  .menu{cursor:pointer;font-size:1.25rem;padding:.2rem .3rem;border-radius:.5rem}
  .menu:active{background:rgba(139,92,246,.18)}
  /* Chat area */
  .chat{height:calc(100dvh - 150px);overflow:auto;padding:1rem;scroll-behavior:smooth}
  .bubble{max-width:min(680px,92%);border:1px solid var(--stroke);border-radius:16px;padding:.9rem 1rem;margin:.4rem 0}
  .bot{background:var(--bubble-bot)}
  .me{background:var(--bubble-user);margin-left:auto}
  /* Composer */
  .composer{position:sticky;bottom:0;z-index:30;padding:.7rem .8rem 1rem;border-top:1px solid var(--stroke);
    background:linear-gradient(180deg,var(--panel2),var(--panel));}
  .row{display:flex;align-items:center;gap:.6rem}
  .btn{border:none;background:transparent;color:var(--text);cursor:pointer}
  .btn.icon{width:42px;height:42px;display:grid;place-items:center;border-radius:10px;border:1px solid var(--stroke)}
  .btn.icon:active{outline:var(--ring)}
  .inputWrap{flex:1;display:flex;align-items:center;gap:.55rem;border:1px solid var(--stroke);background:var(--bg);
    border-radius:12px;padding:.55rem .7rem}
  .inputWrap input{flex:1;border:none;outline:none;background:transparent;color:var(--text);font:inherit}
  .send{background:var(--brand);color:white;border:none;border-radius:12px;padding:.65rem .9rem;font-weight:700}
  .send:active{transform:translateY(1px)}
  /* Plus sheet */
  .sheetBg{position:fixed;inset:0;background:rgba(0,0,0,.35);backdrop-filter:blur(2px);display:none}
  .sheet{position:fixed;left:0;right:0;bottom:0;transform:translateY(110%);transition:.28s ease;z-index:41}
  .sheetInner{background:var(--panel2);border-top:1px solid var(--stroke);border-radius:16px 16px 0 0;padding:1rem}
  .pickGrid{display:grid;grid-template-columns:1fr;gap:.6rem}
  .pick{display:flex;align-items:center;gap:.7rem;border:1px solid var(--stroke);padding:.8rem;border-radius:12px;cursor:pointer}
  .pick:hover{border-color:var(--brand)}
  /* FAQ modal */
  .modalBg{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;z-index:60}
  .modal{position:fixed;inset:0;display:grid;place-items:center;z-index:61}
  .card{width:min(680px,92%);max-height:86dvh;overflow:auto;background:var(--panel);border:1px solid var(--stroke);
    border-radius:18px;padding:1rem 1.1rem 1.2rem;box-shadow:0 12px 40px rgba(0,0,0,.45)}
  .card h2{margin:.3rem 0 1rem;font-size:1.6rem;color:#c9a7ff}
  .packs{display:grid;gap:.6rem;margin:.6rem 0 1rem}
  .pack{display:flex;align-items:center;justify-content:space-between;border:1px solid var(--stroke);padding:.9rem 1rem;border-radius:12px}
  .gift{margin:.6rem 0 0;padding:.75rem 1rem;border-radius:12px;background:rgba(139,92,246,.12);border:1px solid var(--stroke)}
  /* Footer small */
  .foot{display:flex;gap:.5rem;align-items:center;justify-content:center;color:var(--muted);font-size:.92rem;margin:.55rem 0}
  .foot strong{color:#c9a7ff}
  /* Hidden inputs for file access */
  input[type=file]{display:none}
</style>
</head>
<body class="dark">
  <!-- HEADER -->
  <div class="topbar">
    <div class="brand"><span class="dot"></span> Philom√®ne I.A.</div>
    <div class="spacer"></div>
    <div id="toggleMode" class="moon" title="Jour / Nuit">üåô</div>
    <div class="counter" title="Solde tokens">
      <span class="d">üíé</span><span id="tokenCount">1 000 000</span>
    </div>
    <div id="openMenu" class="menu" title="Menu / FAQ">‚ò∞</div>
  </div>

  <!-- CHAT -->
  <div id="chat" class="chat">
    <div class="bubble bot">Bonjour üëã Je suis Philom√®ne I.A., propuls√©e par GPT-5 Thinking.</div>
  </div>

  <!-- COMPOSER -->
  <div class="composer">
    <div class="row">
      <button id="plusBtn" class="btn icon" title="Plus">Ôºã</button>

      <div class="inputWrap">
        <input id="userInput" placeholder="√âcrivez votre message‚Ä¶" autocomplete="off" />
        <button id="micBtn" class="btn" title="Dicter">üé§</button>
      </div>

      <button id="sendBtn" class="send" title="Envoyer">‚û§</button>
    </div>
    <div class="foot">‚öôÔ∏è Propuls√© par <strong>GPT-5 Thinking</strong> ‚Äî la version la plus avanc√©e de Philom√®ne I.A.</div>
  </div>

  <!-- PLUS SHEET -->
  <div id="sheetBg" class="sheetBg"></div>
  <div id="sheet" class="sheet">
    <div class="sheetInner">
      <div class="pickGrid">
        <div id="pickLibrary" class="pick">üñºÔ∏è Phototh√®que</div>
        <div id="pickCamera" class="pick">üì∑ Prendre une photo</div>
        <div id="pickDoc" class="pick">üìÑ Choisir un fichier</div>
      </div>
    </div>
  </div>

  <!-- Hidden inputs -->
  <input id="imgLibrary" type="file" accept="image/*" />
  <input id="imgCamera"  type="file" accept="image/*" capture="environment" />
  <input id="docInput"   type="file" accept="image/*,application/pdf" />

  <!-- FAQ -->
  <div id="faqBg" class="modalBg"></div>
  <div id="faqModal" class="modal" aria-hidden="true" style="display:none">
    <div class="card">
      <h2>üí¨ Foire aux questions</h2>

      <h3>Quelle IA utilise Philom√®ne ?</h3>
      <p>Philom√®ne I.A. est propuls√©e par <strong>GPT-5 Thinking</strong>, la version la plus avanc√©e d‚ÄôOpenAI.</p>

      <h3>Comment fonctionnent les tokens ?</h3>
      <p>Chaque question + r√©ponse consomment un petit nombre de tokens selon leur longueur. Le diamant üíé affiche votre solde.</p>

      <h3>Packs disponibles</h3>
      <div class="packs">
        <div class="pack">üíé 1 000 000 tokens ‚Üí 5 ‚Ç¨</div>
        <div class="pack">üíé 2 000 000 tokens ‚Üí 10 ‚Ç¨</div>
        <div class="pack">üíé 4 000 000 tokens ‚Üí 20 ‚Ç¨</div>
      </div>
      <div class="gift">üéÅ <strong>Premier achat : +50 % offerts</strong> (1,5 M ¬∑ 3 M ¬∑ 6 M)</div>

      <h3>Abonnement ?</h3>
      <p>Non. Toute la puissance de GPT-5, sans abonnement. Vous payez uniquement ce que vous consommez.</p>

      <h3>Confidentialit√©</h3>
      <p>Vos √©changes restent priv√©s.</p>

      <div class="row" style="justify-content:flex-end;margin-top:.8rem">
        <button id="closeFaq" class="btn icon">‚úï</button>
      </div>
    </div>
  </div>

<script>
(() => {
  // ===== CONFIG =====
  const API_URL = "https://api.philomeneia.com/ask";
  const API_IMG = "https://api.philomeneia.com/analyze-image";
  const DEFAULT_TOKENS = 1_000_000;

  // ===== STATE =====
  let tokenCount = Number(localStorage.getItem("tokens") || DEFAULT_TOKENS);
  let theme = localStorage.getItem("theme") || "dark";
  let recognition = null;
  const userId = "guest_" + Math.random().toString(36).slice(2,8);
  const conversation = [];

  // ===== DOM =====
  const chat = document.getElementById("chat");
  const tokenCountEl = document.getElementById("tokenCount");
  const userInput = document.getElementById("userInput");
  const sendBtn = document.getElementById("sendBtn");
  const plusBtn = document.getElementById("plusBtn");
  const micBtn = document.getElementById("micBtn");
  const toggleMode = document.getElementById("toggleMode");
  const menuBtn = document.getElementById("openMenu");

  const sheetBg = document.getElementById("sheetBg");
  const sheet = document.getElementById("sheet");
  const pickLibrary = document.getElementById("pickLibrary");
  const pickCamera = document.getElementById("pickCamera");
  const pickDoc = document.getElementById("pickDoc");
  const imgLibrary = document.getElementById("imgLibrary");
  const imgCamera = document.getElementById("imgCamera");
  const docInput = document.getElementById("docInput");

  const faqBg = document.getElementById("faqBg");
  const faqModal = document.getElementById("faqModal");
  const closeFaq = document.getElementById("closeFaq");

  // ===== INIT =====
  if(theme === "light"){ document.body.classList.remove("dark"); document.body.classList.add("light"); }
  updateTokens();

  // ===== UI helpers =====
  function addMessage(text, who="bot"){
    const b = document.createElement("div");
    b.className = "bubble " + (who === "me" ? "me":"bot");
    b.textContent = text;
    chat.appendChild(b);
    chat.scrollTop = chat.scrollHeight;
  }
  function setTyping(on){
    if(on){
      typingEl = document.createElement("div");
      typingEl.className = "bubble bot";
      typingEl.id = "typing";
      typingEl.textContent = "‚Ä¶";
      chat.appendChild(typingEl);
      chat.scrollTop = chat.scrollHeight;
    }else{
      const t = document.getElementById("typing");
      if(t) t.remove();
    }
  }
  function updateTokens(){
    tokenCountEl.textContent = tokenCount.toLocaleString("fr-FR");
    localStorage.setItem("tokens", tokenCount);
  }

  // ===== Theme toggle =====
  toggleMode.addEventListener("click", () => {
    const isDark = document.body.classList.contains("dark");
    document.body.classList.toggle("dark", !isDark);
    document.body.classList.toggle("light", isDark);
    theme = isDark ? "light" : "dark";
    localStorage.setItem("theme", theme);
  });

  // ===== Send text =====
  async function sendText(){
    const msg = (userInput.value || "").trim();
    if(!msg) return;

    addMessage(msg, "me");
    userInput.value = "";

    // co√ªt estim√© simple (√† affiner plus tard avec tokens r√©els)
    tokenCount = Math.max(0, tokenCount - (20 + Math.ceil(msg.length/12)));
    updateTokens();

    setTyping(true);
    try{
      const body = { userId, conversation:[{role:"user", content:msg}] };
      const resp = await fetch(API_URL, {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify(body)
      });
      const data = await resp.json();
      setTyping(false);

      const answer = data?.answer || "D√©sol√©e, je n‚Äôai pas pu r√©pondre.";
      addMessage(answer, "bot");

      // petite estimation sortie
      tokenCount = Math.max(0, tokenCount - Math.ceil(answer.length/14));
      updateTokens();
    }catch(e){
      setTyping(false);
      addMessage("Erreur r√©seau.", "bot");
    }
  }
  sendBtn.addEventListener("click", sendText);
  userInput.addEventListener("keydown", (e)=>{ if(e.key==="Enter" && !e.shiftKey){ e.preventDefault(); sendText(); }});

  // ===== Mic (Web Speech API si dispo) =====
  micBtn.addEventListener("click", () => {
    const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
    if(!SR){ alert("La dict√©e vocale n‚Äôest pas disponible sur ce navigateur."); return; }
    if(recognition){ recognition.stop(); recognition = null; return; }
    recognition = new SR();
    recognition.lang = "fr-FR";
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;
    recognition.onresult = (ev)=>{
      const txt = ev.results[0][0].transcript || "";
      userInput.value = (userInput.value ? userInput.value+" " : "") + txt;
    };
    recognition.onend = ()=>{ recognition = null; };
    recognition.start();
  });

  // ===== Plus sheet =====
  function openSheet(){
    sheetBg.style.display = "block";
    sheet.style.transform = "translateY(0)";
    sheet.style.display = "block";
  }
  function closeSheet(){
    sheet.style.transform = "translateY(110%)";
    setTimeout(()=>{ sheet.style.display=""; sheetBg.style.display="none"; }, 280);
  }
  plusBtn.addEventListener("click", openSheet);
  sheetBg.addEventListener("click", closeSheet);

  // triggers
  pickLibrary.addEventListener("click", ()=> imgLibrary.click());
  pickCamera.addEventListener("click",  ()=> imgCamera.click());
  pickDoc.addEventListener("click",     ()=> docInput.click());

  imgLibrary.addEventListener("change", (e)=> handleImage(e.target.files?.[0]));
  imgCamera .addEventListener("change", (e)=> handleImage(e.target.files?.[0]));
  docInput  .addEventListener("change", (e)=> handleImage(e.target.files?.[0]));
  
  async function handleImage(file){
    closeSheet();
    if(!file) return;

    const form = new FormData();
    form.append("image", file);
    form.append("userId", userId);
    form.append("prompt", "Analyse cette image et explique clairement ce qu‚Äôelle montre.");

    setTyping(true);
    try{
      const resp = await fetch(API_IMG, { method:"POST", body:form });
      const data = await resp.json();
      setTyping(false);
      const answer = data?.answer || "Image re√ßue, mais je n‚Äôai pas pu l‚Äôanalyser.";
      addMessage(answer, "bot");
      tokenCount = Math.max(0, tokenCount - Math.ceil((answer.length||80)/12));
      updateTokens();
    }catch(e){
      setTyping(false);
      addMessage("Erreur lors de l‚Äôenvoi du fichier.", "bot");
    }finally{
      // reset inputs
      imgLibrary.value = ""; imgCamera.value = ""; docInput.value="";
    }
  }

  // ===== FAQ =====
  function openFaq(){
    faqBg.style.display = "block";
    faqModal.style.display = "grid";
    faqModal.setAttribute("aria-hidden","false");
  }
  function closeFaqFn(){
    faqBg.style.display = "none";
    faqModal.style.display = "none";
    faqModal.setAttribute("aria-hidden","true");
  }
  menuBtn.addEventListener("click", openFaq);
  faqBg.addEventListener("click", closeFaqFn);
  closeFaq.addEventListener("click", closeFaqFn);
})();
</script>
</body>
</html>
