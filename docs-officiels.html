<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>Philom√®ne I.A. ‚Äì Documents officiels</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#0b0b10;
      --panel:#141420;
      --panel2:#181828;
      --accent:#7A4DFF;
      --accent2:#9F7BFF;
      --text:#EAEAF2;
      --text-dim:#A9A9C0;
      --radius:16px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      padding:16px;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      background: radial-gradient(circle at top, #1b1b2b 0, #050509 45%, #020308 100%);
      color:var(--text);
      display:flex;
      flex-direction:column;
      gap:14px;
    }
    header{
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    h1{
      margin:0;
      font-size:22px;
    }
    .tagline{
      margin:0;
      color:var(--text-dim);
      font-size:14px;
    }
    main{
      flex:1;
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .card{
      background:linear-gradient(135deg, rgba(20,20,32,.96), rgba(20,20,40,.98));
      border-radius:var(--radius);
      border:1px solid rgba(255,255,255,.06);
      box-shadow:0 18px 40px rgba(0,0,0,.55);
      padding:14px;
    }
    label{
      display:block;
      font-size:14px;
      margin-bottom:4px;
      color:var(--text-dim);
    }
    select, input, textarea{
      width:100%;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.12);
      background:var(--panel2);
      padding:9px 10px;
      color:var(--text);
      font-size:15px;
      outline:none;
    }
    select:focus, input:focus, textarea:focus{
      border-color:var(--accent2);
      box-shadow:0 0 0 1px rgba(122,77,255,.4);
    }
    textarea{
      min-height:80px;
      resize:vertical;
    }
    .row{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
    }
    .row > div{
      flex:1;
      min-width:130px;
    }
    .hint{
      font-size:12px;
      color:var(--text-dim);
      margin-top:4px;
    }
    .actions{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-top:10px;
      align-items:center;
    }
    button{
      border-radius:999px;
      border:0;
      padding:10px 16px;
      font-size:15px;
      font-weight:600;
      cursor:pointer;
    }
    #btnGenerate{
      background:linear-gradient(135deg, var(--accent), var(--accent2));
      color:#fff;
      box-shadow:0 10px 24px rgba(122,77,255,.45);
    }
    #btnCopy{
      background:var(--panel2);
      color:var(--text);
      border:1px solid rgba(255,255,255,.12);
    }
    #status{
      font-size:13px;
      color:var(--text-dim);
    }
    #status.ok{ color:#6CF29A; }
    #status.err{ color:#f97373; }

    #output{
      min-height:220px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,"Liberation Mono","Courier New", monospace;
      white-space:pre-wrap;
    }
    footer{
      font-size:12px;
      color:var(--text-dim);
      text-align:center;
      margin-top:4px;
    }
  </style>
</head>
<body>
  <header>
    <h1>üìÑ Philom√®ne ‚Äì Documents officiels</h1>
    <p class="tagline">
      G√©n√®re des lettres propres et pr√™tes √† envoyer (attestation, r√©siliation, autorisation, etc.).
    </p>
  </header>

  <main>
    <!-- FORMULAIRE -->
    <section class="card">
      <div style="margin-bottom:10px">
        <label for="docType">Type de document √† g√©n√©rer</label>
        <select id="docType">
          <option value="attestation">Attestation sur l‚Äôhonneur</option>
          <option value="resiliation">Lettre de r√©siliation (contrat, abonnement‚Ä¶)</option>
          <option value="autorisation_parentale">Autorisation parentale</option>
          <option value="lettre_ecole">Lettre pour l‚Äô√©cole (retard, absence, demande)</option>
          <option value="lettre_employeur">Lettre √† l‚Äôemployeur (demande, info, arr√™t‚Ä¶)</option>
          <option value="contestation_amende">Contestation d‚Äôamende</option>
        </select>
      </div>

      <div class="row">
        <div>
          <label for="yourName">Ton nom complet</label>
          <input id="yourName" type="text" placeholder="Pr√©nom NOM" />
        </div>
        <div>
          <label for="cityDate">Lieu + date</label>
          <input id="cityDate" type="text" placeholder="Ville, le 12/11/2025" />
        </div>
      </div>

      <div class="row" style="margin-top:8px">
        <div>
          <label for="address">Ton adresse</label>
          <input id="address" type="text" placeholder="Rue, n¬∞, code postal, ville" />
        </div>
      </div>

      <div style="margin-top:8px">
        <label for="recipient">Destinataire</label>
        <input id="recipient" type="text" placeholder="Nom du destinataire, organisme, adresse‚Ä¶" />
      </div>

      <div style="margin-top:8px">
        <label for="details">Explique ta situation (le plus clairement possible)</label>
        <textarea id="details" placeholder="Exemple : Je souhaite r√©silier mon abonnement internet chez X car‚Ä¶"></textarea>
        <div class="hint">
          Plus tu expliques ta situation, plus la lettre sera pr√©cise et utile.
        </div>
      </div>

      <div class="actions">
        <button id="btnGenerate">‚ú® G√©n√©rer la lettre</button>
        <button id="btnCopy" type="button">üìã Copier le texte</button>
        <span id="status"></span>
      </div>
    </section>

    <!-- R√âSULTAT -->
    <section class="card">
      <label for="output">Lettre g√©n√©r√©e</label>
      <textarea id="output" placeholder="Ta lettre appara√Ætra ici‚Ä¶"></textarea>
    </section>
  </main>

  <footer>
    Philom√®ne I.A. ‚Äì G√©n√©rateur de documents officiels (b√™ta).
  </footer>

  <script>
    // ‚ö†Ô∏è IMPORTANT : pour les tests SEULEMENT.
    // Mets ici ta cl√© OpenAI (celle que tu utilises d√©j√† pour tes tests perso).
    const OPENAI_API_KEY = "TA_CLE_OPENAI_ICI"; // ‚Üê √† remplacer

    const docTypeEl   = document.getElementById("docType");
    const nameEl      = document.getElementById("yourName");
    const cityDateEl  = document.getElementById("cityDate");
    const addressEl   = document.getElementById("address");
    const recipientEl = document.getElementById("recipient");
    const detailsEl   = document.getElementById("details");
    const outEl       = document.getElementById("output");
    const statusEl    = document.getElementById("status");
    const btnGen      = document.getElementById("btnGenerate");
    const btnCopy     = document.getElementById("btnCopy");

    function setStatus(msg, type){
      statusEl.textContent = msg || "";
      statusEl.className = "";
      if(type) statusEl.classList.add(type);
    }

    function buildInstruction(type){
      switch(type){
        case "attestation":
          return "R√©dige une attestation sur l‚Äôhonneur simple, claire et polie.";
        case "resiliation":
          return "R√©dige une lettre de r√©siliation claire, avec date de prise d‚Äôeffet et r√©f√©rences si possible.";
        case "autorisation_parentale":
          return "R√©dige une autorisation parentale officielle, avec formule adapt√©e.";
        case "lettre_ecole":
          return "R√©dige une lettre destin√©e √† une √©cole (direction / enseignant), ton poli, clair et rassurant.";
        case "lettre_employeur":
          return "R√©dige une lettre adress√©e √† un employeur (ou RH), ton professionnel mais humain.";
        case "contestation_amende":
          return "R√©dige une lettre de contestation d‚Äôamende, argument√©e, polie et factuelle.";
        default:
          return "R√©dige une lettre administrative claire et polie.";
      }
    }

    async function generateLetter(){
      const type      = docTypeEl.value;
      const yourName  = nameEl.value.trim();
      const cityDate  = cityDateEl.value.trim();
      const address   = addressEl.value.trim();
      const recipient = recipientEl.value.trim();
      const details   = detailsEl.value.trim();

      if(!yourName || !recipient || !details){
        setStatus("Merci de remplir au minimum ton nom, le destinataire et la situation.", "err");
        return;
      }
      if(!OPENAI_API_KEY || OPENAI_API_KEY === "TA_CLE_OPENAI_ICI"){
        setStatus("‚ö†Ô∏è Cl√© OpenAI manquante dans le code (OPENAI_API_KEY).", "err");
        return;
      }

      const instruction = buildInstruction(type);

      const userPrompt =
        `Type de document : ${type}\n\n` +
        `Nom complet : ${yourName}\n` +
        (address ? `Adresse : ${address}\n` : "") +
        (cityDate ? `Lieu + date : ${cityDate}\n` : "") +
        (recipient ? `Destinataire : ${recipient}\n` : "") +
        `\nSituation d√©taill√©e :\n${details}\n\n` +
        "G√©n√®re une lettre compl√®te en fran√ßais, avec mise en forme classique " +
        "(adresse de l‚Äôexp√©diteur, destinataire, objet si utile, corps du texte, formule de politesse, signature).";

      setStatus("‚è≥ G√©n√©ration en cours‚Ä¶", "");
      btnGen.disabled = true;

      try{
        const resp = await fetch("https://api.openai.com/v1/chat/completions", {
          method:"POST",
          headers:{
            "Content-Type":"application/json",
            "Authorization":"Bearer " + OPENAI_API_KEY
          },
          body: JSON.stringify({
            model: "gpt-4o-mini",
            messages: [
              {
                role: "system",
                content:
                  "Tu es Philom√®ne I.A., une assistante personnelle fran√ßaise. " +
                  "Tu r√©diges des lettres administratives claires, sans blabla inutile, " +
                  "avec une mise en forme correcte et un ton poli."
              },
              { role:"user", content: instruction + "\n\n" + userPrompt }
            ],
            temperature: 0.4,
          })
        });

        if(!resp.ok){
          const errText = await resp.text();
          console.error("OpenAI error:", resp.status, errText);
          setStatus("‚ùå Erreur OpenAI (" + resp.status + "). V√©rifie la cl√© ou r√©essaie.", "err");
          return;
        }

        const data = await resp.json();
        const text = data?.choices?.[0]?.message?.content?.trim() || "";
        if(!text){
          setStatus("R√©ponse vide re√ßue. R√©essaie.", "err");
          return;
        }

        outEl.value = text;
        setStatus("‚úÖ Lettre g√©n√©r√©e. Tu peux la relire, modifier ou copier.", "ok");
      }catch(e){
        console.error(e);
        setStatus("‚ùå Erreur de connexion √† l‚ÄôAPI. V√©rifie ton r√©seau.", "err");
      }finally{
        btnGen.disabled = false;
      }
    }

    function copyOutput(){
      if(!outEl.value.trim()){
        setStatus("Rien √† copier pour l‚Äôinstant.", "err");
        return;
      }
      outEl.select();
      try{
        document.execCommand("copy");
        setStatus("üìã Lettre copi√©e dans le presse-papier.", "ok");
      }catch{
        setStatus("Impossible de copier automatiquement. S√©lectionne le texte √† la main.", "err");
      }
    }

    btnGen.addEventListener("click", generateLetter);
    btnCopy.addEventListener("click", copyOutput);
  </script>
</body>
</html>
