<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Philom√®ne I.A.</title>
  <style>
    :root{
      --bg:#0c0c0f;--fg:#e8e7ef;--muted:#b7b4c7;--card:#16161b;
      --line:#5b22ff;--chip:#242433;--good:#7cf892;
    }
    .light{
      --bg:#ffffff;--fg:#17181c;--muted:#505368;--card:#f2f3f7;
      --line:#6a3dff;--chip:#e9e9f2;--good:#1c8d52;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;background:var(--bg);color:var(--fg);
      font:16px/1.45 -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Inter,Helvetica,Arial,sans-serif;
    }

    /* ====== HEADER ====== */
    .topbar{
      position:sticky;top:0;z-index:30;
      background:linear-gradient(180deg,rgba(0,0,0,.35),transparent);
      backdrop-filter:blur(6px);
      padding:14px 14px 10px;
      border-bottom:1px solid rgba(255,255,255,.06);
    }
    .row{display:flex;align-items:center;gap:10px}
    .grow{flex:1}
    .chip{
      background:var(--chip);color:var(--fg);border:1px solid rgba(255,255,255,.08);
      padding:9px 14px;border-radius:14px;display:inline-flex;align-items:center;gap:8px;
      font-weight:600;cursor:pointer;user-select:none;
      transition:transform .06s ease,opacity .2s ease;
    }
    .chip:active{transform:scale(.98)}
    .ghost{background:transparent;border-color:rgba(255,255,255,.15)}
    .round{width:38px;height:38px;border-radius:12px;display:flex;justify-content:center;align-items:center}
    .diamond{filter:drop-shadow(0 0 14px rgba(108,92,255,.55))}
    .counter{font-weight:800;letter-spacing:.03em}

    .ver-line{
      margin-top:10px;color:var(--muted);font-size:.9rem;
      display:flex;align-items:center;gap:8px;opacity:.9
    }
    .ver-dot{width:8px;height:8px;border-radius:50%;background:#a88cff;box-shadow:0 0 10px #a88cff}

    /* ====== MAIN / CHAT ====== */
    .container{max-width:980px;margin:0 auto;padding:10px 14px 110px}
    .bubble{background:var(--card);padding:14px 16px;border-radius:16px;margin:12px 0;max-width:92%}
    .bot{border:1px solid rgba(255,255,255,.07)}
    .typing{opacity:.65;font-style:italic}

    /* ====== INPUT BAR ====== */
    .input-wrap{
      position:fixed;left:0;right:0;bottom:0;z-index:25;
      background:linear-gradient(180deg,transparent,rgba(0,0,0,.45) 30%,rgba(0,0,0,.65));
      padding:12px 10px 16px;border-top:1px solid rgba(255,255,255,.06);
    }
    .input-row{max-width:980px;margin:0 auto;display:flex;align-items:center;gap:10px}
    .plus{background:var(--chip);border:1px solid rgba(255,255,255,.12);width:46px;height:46px;border-radius:14px;font-size:22px;font-weight:700}
    .field{
      flex:1;display:flex;align-items:center;gap:10px;
      background:var(--card);border:1px solid rgba(255,255,255,.12);border-radius:16px;
      padding:10px 12px;
    }
    #userInput{
      flex:1;border:0;outline:0;background:transparent;color:var(--fg);font-size:16px;
    }
    .send{
      width:46px;height:46px;border-radius:14px;border:0;cursor:pointer;color:#fff;
      background:linear-gradient(180deg,#7b5cff,#5b22ff);
      box-shadow:0 8px 24px rgba(91,34,255,.35)
    }

    /* ====== SHEET ====== */
    .sheet-bg{position:fixed;inset:0;background:rgba(0,0,0,.45);backdrop-filter:blur(2px);display:none}
    .sheet{position:fixed;left:0;right:0;bottom:0;background:var(--card);border-radius:18px 18px 0 0;
      border-top:2px solid var(--line);box-shadow:0 -12px 40px rgba(0,0,0,.5);display:none}
    .sheet .title{padding:14px 18px;font-weight:800}
    .sheet ul{list-style:none;margin:0;padding:0}
    .sheet li{padding:14px 18px;border-top:1px solid rgba(255,255,255,.06);display:flex;gap:12px;align-items:center;cursor:pointer}
    .sheet li:hover{background:rgba(255,255,255,.04)}
    .x{margin-left:auto;opacity:.7}

    /* ====== POWERED ====== */
    .powered{
      text-align:left;max-width:980px;margin:6px auto 86px;color:var(--muted);padding:0 14px;
      font-size:.95rem
    }

    /* Small */
    @media (max-width:520px){
      .chip{padding:8px 12px}
      .counter{font-weight:700}
    }
  </style>
</head>
<body class="dark">
  <!-- ========= TOPBAR ========= -->
  <div class="topbar">
    <div class="row">
      <div class="grow"></div>
      <button id="loginBtn" class="chip ghost">Connexion</button>
      <button id="buyBtn" class="chip">Acheter</button>
      <button id="modeBtn" class="chip round" title="Jour/Nuit">üåô</button>
      <span class="chip">
        <span class="diamond">üíé</span>
        <span id="tokenCount" class="counter">1000000</span>
      </span>
      <button id="menuBtn" class="chip round" title="Menu">‚ò∞</button>
    </div>
    <div class="ver-line">
      <span class="ver-dot"></span>
      <span>Philom√®ne I.A. ‚Äî <strong>version 1.0</strong></span>
    </div>
  </div>

  <!-- ========= MAIN ========= -->
  <div id="chat" class="container">
    <div class="bubble bot">Bonjour üëã Je suis Philom√®ne I.A., propuls√©e par GPT-5 Thinking.</div>
  </div>

  <!-- ========= INPUT ========= -->
  <div class="input-wrap">
    <div class="input-row">
      <button id="plusBtn" class="plus">+</button>
      <div class="field">
        <input id="userInput" type="text" placeholder="√âcrivez votre message‚Ä¶" />
      </div>
      <button id="sendBtn" class="send">‚û§</button>
    </div>
  </div>

  <!-- ========= SHEET ========= -->
  <div id="sheetBg" class="sheet-bg"></div>
  <div id="sheet" class="sheet">
    <div class="title">Ajouter au message</div>
    <ul>
      <li id="pickCamera">üì∑ Prendre une photo <span class="x">‚Ä∫</span></li>
      <li id="pickLibrary">üñºÔ∏è Depuis la galerie <span class="x">‚Ä∫</span></li>
      <li id="pickFile">üìÑ Choisir un fichier <span class="x">‚Ä∫</span></li>
      <li id="closeSheet" style="color:#a7a3bf">Fermer</li>
    </ul>
  </div>

  <!-- Inputs cach√©s -->
  <input id="inCamera" type="file" accept="image/*" capture="environment" hidden />
  <input id="inLibrary" type="file" accept="image/*" hidden />
  <input id="inFile" type="file" accept="image/*,application/pdf" hidden />

  <!-- ========= POWERED ========= -->
  <div id="powered" class="powered">
    <span style="opacity:.9">‚öôÔ∏è Propuls√© par <strong>GPT-5 Thinking</strong> ‚Äî la version la plus avanc√©e de Philom√®ne I.A.</span>
  </div>

  <script>
    // ========= CONFIG =========
    const API_URL = "https://api.philomeneia.com/ask";
    const API_IMG = "https://api.philomeneia.com/analyze-image";
    let SHOW_POWERED = true; // passe √† false pour masquer la ligne "Propuls√© par..."

    // Tokens (visuel simple)
    let tokenCount = 1_000_000;

    // ========= DOM =========
    const chat = document.getElementById("chat");
    const userInput = document.getElementById("userInput");
    const sendBtn = document.getElementById("sendBtn");
    const plusBtn = document.getElementById("plusBtn");
    const tokenCountEl = document.getElementById("tokenCount");
    const modeBtn = document.getElementById("modeBtn");
    const powered = document.getElementById("powered");
    const loginBtn = document.getElementById("loginBtn");
    const buyBtn = document.getElementById("buyBtn");

    // Sheet
    const sheet = document.getElementById("sheet");
    const sheetBg = document.getElementById("sheetBg");
    const pickCamera = document.getElementById("pickCamera");
    const pickLibrary = document.getElementById("pickLibrary");
    const pickFile = document.getElementById("pickFile");
    const closeSheet = document.getElementById("closeSheet");
    const inCamera = document.getElementById("inCamera");
    const inLibrary = document.getElementById("inLibrary");
    const inFile = document.getElementById("inFile");

    if(!SHOW_POWERED) powered.style.display = "none";

    // ========= HELPERS =========
    function addBubble(text, who="bot"){
      const b = document.createElement("div");
      b.className = "bubble " + (who==="bot"?"bot":"");
      b.textContent = text;
      chat.appendChild(b);
      chat.scrollTo({top: chat.scrollHeight, behavior:"smooth"});
    }
    function setTyping(on){
      const id = "typing";
      const el = document.getElementById(id);
      if(on && !el){
        const t = document.createElement("div");
        t.id = id; t.className = "bubble bot typing";
        t.textContent = "‚Ä¶";
        chat.appendChild(t);
        chat.scrollTo({top: chat.scrollHeight, behavior:"smooth"});
      }else if(!on && el){
        el.remove();
      }
    }
    function updateTokens(delta){
      tokenCount = Math.max(0, tokenCount - (delta||0));
      tokenCountEl.textContent = tokenCount.toLocaleString("fr-FR").replace(/\s/g,'');
    }

    // Rough token estimate
    const estTokens = (txt) => Math.max(10, Math.ceil(txt.length/3));

    // ========= SEND TEXT =========
    async function sendText(){
      const msg = userInput.value.trim();
      if(!msg) return;
      addBubble(msg, "user");
      userInput.value = "";
      setTyping(true);

      try{
        const resp = await fetch(API_URL, {
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body: JSON.stringify({
            userId: "guest",
            conversation: [{role:"user", content: msg}]
          })
        });
        const data = await resp.json();
        setTyping(false);
        if(data && data.answer){
          addBubble(data.answer,"bot");
          // d√©bit visuel
          updateTokens(estTokens(msg) + estTokens(data.answer));
        }else{
          addBubble("D√©sol√©, une erreur est survenue.");
        }
      }catch(e){
        setTyping(false);
        addBubble("Erreur r√©seau.");
      }
    }

    sendBtn.addEventListener("click", sendText);
    userInput.addEventListener("keydown", (e)=>{
      if(e.key==="Enter" && !e.shiftKey){ e.preventDefault(); sendText(); }
    });

    // ========= MODE jour/nuit =========
    let dark = true;
    function applyMode(){
      document.body.classList.toggle("light", !dark);
      modeBtn.textContent = dark ? "üåô" : "‚òÄÔ∏è";
    }
    modeBtn.addEventListener("click", ()=>{ dark = !dark; applyMode(); });
    applyMode();

    // ========= SHEET =========
    function openSheet(){ sheet.style.display="block"; sheetBg.style.display="block"; }
    function closeSheetFn(){ sheet.style.display="none"; sheetBg.style.display="none"; }
    plusBtn.addEventListener("click", openSheet);
    sheetBg.addEventListener("click", closeSheetFn);
    closeSheet.addEventListener("click", closeSheetFn);

    pickCamera.addEventListener("click", ()=> inCamera.click());
    pickLibrary.addEventListener("click", ()=> inLibrary.click());
    pickFile.addEventListener("click", ()=> inFile.click());

    async function sendImage(file){
      if(!file) return;
      closeSheetFn();
      setTyping(true);
      try{
        const form = new FormData();
        form.append("image", file);
        form.append("userId", "guest");
        form.append("prompt", "Analyse cette image et explique clairement.");

        const resp = await fetch(API_IMG, { method:"POST", body: form });
        const data = await resp.json();
        setTyping(false);
        if(data && data.answer){
          addBubble(data.answer,"bot");
          updateTokens( Math.ceil((data.answer||"").length/3) + 64 );
        }else{
          addBubble("Image re√ßue mais pas de r√©ponse.");
        }
      }catch(e){
        setTyping(false);
        addBubble("Erreur lors de l‚Äôenvoi de l‚Äôimage.");
      }
    }
    inCamera.addEventListener("change", ()=> sendImage(inCamera.files?.[0]));
    inLibrary.addEventListener("change", ()=> sendImage(inLibrary.files?.[0]));
    inFile.addEventListener("change", ()=> sendImage(inFile.files?.[0]));

    // ========= DIALOGS Connexion / Acheter (placeholders) =========
    loginBtn.addEventListener("click", ()=>{
      alert("Connexion : lier ton compte (placeholder).");
    });
    buyBtn.addEventListener("click", ()=>{
      alert("Acheter des tokens : 1M=5‚Ç¨ ‚Ä¢ 2M=10‚Ç¨ ‚Ä¢ 4M=20‚Ç¨ (+50% au 1er achat).");
    });

    // Init
    updateTokens(0);
  </script>
</body>
</html>
